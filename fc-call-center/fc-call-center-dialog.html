<link rel="import" href="fc-course-calendar-creation-behavior.html">
<link rel="import" href="../bower_components/iron-form/iron-form.html">
 <link rel="import" href="fc-calendar-behavior-beta-prime.html"> 
<link rel="import" href="../fc-grid/fc-grid-style-behavior.html">
<link rel="import" href="../fc-grid/fc-draggable-behavior.html">
<link rel="import" href="fc-profile-class.html">
<link rel="import"  href="fc-calendar-controller-behavior.html">





<link rel="import" href="../fc-grid/data-manager.html">
<link rel="import" href="../bower_components/paper-card/paper-card.html">
<link rel="import" href="../bower_components/paper-button/paper-button.html">
<link rel="import" href="../bower_components/neon-animation/neon-animated-pages.html">
<link rel="import" href="../bower_components/neon-animation/neon-animatable-behavior.html">
<link rel="import" href="../bower_components/neon-animation/neon-animation-runner-behavior.html">
<link rel="import" href="../bower_components/neon-animation/neon-animation-behavior.html">
<link rel="import" href="../bower_components/neon-animation/neon-animations.html">
<link rel="import" href="../bower_components/paper-listbox/paper-listbox.html">
<link rel="import" href="../bower_components/paper-icon-button/paper-icon-button.html">
<link rel="import" href="../bower_components/paper-item/paper-item.html">
<link rel="import" href="../bower_components/paper-radio-button/paper-radio-button.html">
<link rel="import" href="../bower_components/paper-radio-group/paper-radio-group.html">
<link rel="import" href="../bower_components/iron-image/iron-image.html"><!-- 
<link rel="import" href="../bower_components/firebase-element/firebase-collection.html"> -->
<link rel="import" href="../fc-grid/fc-iss-input.html">
<link rel="import" href="../fc-grid/fc-ddr-card.html">
<link rel="import" href="../fc-grid/data-manager.html">




<link rel="import" href="fc-textarea-buttons-form.html">


<!-- <link rel="import" href="fc-inquiry.html">
<link rel="import" href="fc-tabbed-card.html">
<link rel="import" href="fc-call-list-view.html">
<link rel="import" href="fc-call-item.html"> -->
<link rel="import" href="FC_frontpage_logo.png">
<link rel="import" href="fc-call-center-form-one.html">
<link rel="import" href="fc-call-center-form.html">


<!-- 
<link rel="import" href="fc-tabbed-card-plus.html"> -->
<!-- <link rel="import" href="FC_frontpage_logo.png"> -->
<link rel="import" href="../src/fc-grid.html">
<dom-module id="fc-call-center-dialog">

<template>
<style>
:host{
      /*background: white;*/
      height: 0px;
      width: 0px;
      position: fixed;
      opacity: 1;
      @apply(--horizontal-layout);

      }
     
    .headerLeft{
      height: 42px; width: 42px; color: white; float: left;top: 5px;
    }
    .headerRight{
      height: 42px; width: 42px; color: white; float: right;top: 5px;
      }
      .intakeForm{
      	border: 1px #efefef solid;
      	margin: 12px 0px;
      }
     
		paper-button{
		 	 width: 50%;
		 	 min-width: 147px;
		 	 font-weight: 600; 	  
		 	 font-size: 14px;
		 	 text-align: center;
		 	 white-space: nowrap;
		 	 max-height: 36px;
		 	 @apply(--layout-nowrap);
		 	 background: white;
		 	 border: #efefef 1px solid;
		 }
		 paper-button.green{
		 	color: green; 
		 	border: 2px solid green;
		}
    fc-ddr-card{
      min-width: 40px;
      min-height: 40px;
      max-height: 600px;
      max-width: 580px;
    }
		paper-button.darkblue{
			color: #009;
			border: 2px solid #009;
		}
		paper-button.red{
			color: red;
			border: 2px solid red;
		}
		paper-button.orange{
			color: orange;
			border: 2px solid orange;
		}
		paper-button:hover, paper-button:active{
			box-shadow: 2px 4px 7px 2px; 

		} 
		paper-button.darkblue:hover, paper-button.darkblue:active{
			box-shadow: 2px 4px 7px 2px gold; 

		} 
		.buttonRow{
			@apply(--layout-flex);
			@apply(--layout-horizontal);
			padding: 2px;
		}

.footerclass{
	height: 32px;
	padding: 14px;
	color: white;
	background: #03A9F4;
	font-weight: 600;
	text-align: center;
	font-size: 11px;
}
.slides{overflow: hidden; overflow-y: scroll;}

.one{
	font-family: merriweather; 
	font-weight: 600;
	color: #080808;
	font-size: 14px;

	white-space: nowrap;
	display: inline-block;
}
      paper-card{
        width: 100%;
        --paper-card-header-image-text:{color:#009; position: absolute; right: 32px; top: 45px;}
        --paper-card-header-image: {width: 165px; height: 120px; margin: 12px 16px 16px 16px;};
        --paper-card-header:{height: 95px; border-bottom: double 6px green;}
  
    }
  
      neon-animated-pages {
        @apply(--layout-flex);
        @apply(--layout-horizontal)
        margin: 12px 0px 12px 0px
        padding: 12px;
        background: white;
        @apply(--layout-self-stretch);
        /*min-height: 1080px;*/
        height: 100%;
      }
      neon-animatable {
        color: white;
        @apply(--layout-horizontal);
        @apply(--layout-center-center);
        @apply(--paper-font-display3);
        margin: 0px;
        padding: 0px;
      }
    
    .subheading {
    font-size: 14px;
    color: brown;
    font-family: times;
 		float: right;
 		margin: 0px 12px;
    padding: 8px;
    }
    paper-radio-button{
    		font-size: 16px;
    		font-weight: 600;
    		size: var(--paper-radio-size, 18px);
    		 /*  --paper-radio-button-label-color: var(--my-blue-009, #000099);*/
    		   --paper-radio-button-checked-color: var(--paper-green-900);


    }
    .card-actions{
    	padding: 16px 8px;
    }
    label.returningCaller{
    	color: black;
    	font-size: 16px;
    /*	font-style: italic;*/
    	font-weight: 700;
    }
    paper-radio-group.tallbox{
    	@apply(--layout-vertical);
    	 --paper-radio-group-padding: var(--too-much-padding, 6px);

    }
    
    p{
    	text-indent: 36px;
    	font-size: 14px;
    	font-weight: 600;
    		}
  .setHeight {
    min-height: 68px;
    max-height: 980px;

    max-width: 485px;
    width: 320px;
    margin: 4px;
    padding: 4px;
  }
  
  .timestamp{
  	font-weight: 600;
  	font-size: 16px;
  	padding: 8px;
  	float: left;

  }		
  .check{
			font-size:26px;
			color: green;
			position: absolute;
			left: 5px;
		}
		.instruction{
			color:#009;
			font-weight:700;
		}
		.radioGroupBlock{
			padding: 12px;

		},
		.importantNote{
				color: black;
				font-weight: 600;
				padding: 8px;
				margin: 4px;
				margin-bottom: 26px;

		},
		.detailPads{
				margin:12px;
				margin-top: 24px;

		}
    .headerCenter{
      font-size: 12px;
      font-weight: 300;
    }

		.show {display:block; z-index: 45; right: 0;}
  @media(max-width: 687px){
  	#content{
  		@apply(--layout-vertical);
  		@apply(--layout-center);
  	}

  	/*add more here*/
  }
  </style>
<form is="iron-form" id="callIntakeForm" method="get" action="/">
  <fc-ddr-card id="focusedCallInterface"  waterfall head-class="darkBlue" header-title="{{chosen}}" class="vertical layout flex nowrap self-stretch" on-tap="_tapHandler" style="padding-right:2px; margin: 4px 0px 4px 0px; min-width: 100%!important;">


  <div class="dropdown headerLeft horizontal layout">
   <span btn="leftClick" style="position: absolute; left: -30px; top: 8px; font-size: 18px; cursor: pointer;">&#8678;</span>
   <!--   <span style="cursor: pointer;">&#9994;</span> -->
  </div>
  <div class="headerCenter" on-tap="changeAppInterfaceForInputs">Tap Here </div>

     <div class="dropdown headerRight">
          <span btn="rightClick" style="position: absolute; right: -30px; top: 8px; font-size: 18px; cursor: pointer;">&#8680;</span>
         <!--  <span style="cursor: pointer; font-size:28px;">&#9995;</span> -->

    </div>
 	<div class="flex layout horizontal center-justified">
 		<section id="hanger" ></section>
    
        <neon-animated-pages id="pages" selected="{{selected}}" entry-animation="[[entryAnimation]]" exit-animation="[[exitAnimation]]">
            <div id="container1">
                <fc-call-center-form-one style="padding: 22px;" page-index="{{selected}}" search-off="{{searchOff}}" inquiry="{{inquiry}}" value-object='{{valueObject}}' id="childOne" current-height="{{childHeight}}">
                        <span class="pageTotal">{{shadowIndex}}</span>
                        <section class="next" style="color: brown; font-size:  20px; float: right; text-align: right;" btn="rightClick">NEXT PAGE &#10148</section>
                </fc-call-center-form-one>
            </div>
        
            <template is="dom-repeat" items="{{inputsDisplayArray}}">
                <div>
                    <fc-call-center-form value-object="{{valueObject}}" search-off="{{searchOff}}" focused-manager="{{focusedManager}}" input-array="{{item}}" current-height="{{siblingHeight}}" page-number="{{computePageNumber(selected)}}" item-object="{{item}}" >
                        <span class="pageTotal" on-tap="openCollapse">{{_computePageTotal(selectedApi, index)}}</span>  <span class="pageTotal">{{shadowIndex}}</span>
                        <section class="next" style="color: brown; padding: 12px 28px; font-size: 20px; float: right; text-align: right; " btn="rightClick">NEXT PAGE &#10148</section>
                        
                        <section class="horizontal layout flex buttons"><paper-button class="flex-1" btn="leftClick">back</paper-button>
                        <paper-button class="flex-1" id="one" btn="rightClick">CONTINUE</paper-button>
                      
                              <paper-button class="darkblue" on-tap="submitHandler">Submit</paper-button>
                                </section>
                    </fc-call-center-form>
                </div>
            </template>

        </neon-animated-pages>
    </fc-ddr-card>
     </form>
   
    
</template>
<script>
FcCallCenterDialog=Polymer({
	is:"fc-call-center-dialog",
		 behaviors:[Polymer.NeonAnimatableBehavior,
                Polymer.NeonAnimationBehavior,
                Polymer.NeonAnimationRunnerBehavior,
                FCBehaviors.FcCalendarOptionsSelectorBehavior,
                FCBehaviors.FcGridStyleBehavior, 
                FCBehaviors.DraggableBehavior,
                FCBehaviors.FocusedDataManagerBehavior,
                FCBehaviors.FcCalendarControllerBehavior],
          
        listeners: {"onload":"doStuffOnLoad",
                        },
        observers:['observerForSearch(isSearchRequired.isPreviousCaller, isSearchRequired.callerRole)', 'observeInputsDisplayArray(inputsDisplayArray)','deepObserveValueObject(valueObject.*)'],
    properties: {

      entryAnimation: {
          type: String,
          value: function(){ return "";},
          notify: true
        },
        shadowIndex:{
            type: String,
            notify: true
        },
        exitAnimation:{
            type: String,
            value: function(){return "";},
            notify: true
        },
 
    valueObject:{
      type: Object,
      value: function(){return {};}, 
      notify: true,
    },
    superValue:{
      type: Object,
      value: function(){return {};},
      notify: true,

    },
 
    childHeight:{
        type: String,
        notify: true,
    },
    siblingHeight:{
        type: String,
        computed: "_computeSiblingHeight(childHeight)",
        notify: true,
    },
    searchOff:{
      type: Boolean,
      notify: true, 
      observer:"observeSearchOff",
     
    },

    selected: {
          type: Number,
          value: function(){return 0;},
          notify: true,
          observer: "observeSelected",
        },
    hasFocusedProfile:{
      type: Boolean,
      value: function(){return false;},
      notify: true,
    },
     
    currentPage:{
      type: Number,
      computed:"computePageNumber(selected)",
      notify: true
    },
    isFormSubmitted:{
        type: Boolean,
        value: false,
        notify: true
      },
   
  },//end of properties
		
  ready(){
   
  },
  observeSelected(nv, ov){
    if(nv){console.log(nv,ov);}


  },
  computeIsSearchRequired(hasFocusedProfile){},
  observeSearchOff(nv, ov){if(nv){
      console.log(nv);}},
    deepObserveValueObject(nv){ 
      if(nv&&nv.value){
       var keys =Object.keys(nv.value);
       console.log(nv.value, nv.base);
       var retVal =this.searchMatchSet(nv.value, nv.base);
        if(retVal!=undefined){
            var count =this.inputsDisplayArray.length;
        console.log(count);
          for(var i=0;i<count;i++)
          {
              var pageInputArray=this.inputsDisplayArray[i];
              var inputSetCount=pageInputArray.length;
               this.inputsDisplayArray[i].forEach((val, j, arr)=>{
                    if(nv.base[val.nameA]!=undefined){this.set(["inputsDisplayArray",i,j,"valueA"],nv.value[val.nameA]);}
                    if(nv.base[val.nameB]!=undefined){this.set(["inputsDisplayArray",i,j,"valueB"],nv.value[val.nameB]);} 
               });
          }

        }}
    }, 

  doStuffOnLoad(e){
         this.async(function(){var ht=window.getComputedStyle(this.$.container1, null).getPropertyValue("height"); var wt=window.getComputedStyle(this.$.container1, null).getPropertyValue("width");//console.log(ht, wt);
          this.style.width="440px"; this.style.height="660px";}, 4);
        //console.log(window.getComputedStyle(this.$.container1, null).getPropertyValue("height"), e);
     },
searchMatchSet(valz, base){
if(this.superValue){
        this.valueObject[base.name]=base.value;
        //console.log(this.valueObject);
        this.superValue=Object.assign(this.superValue, this.valueObject);
        //console.log(this.valueObject, this.superValue, base.name, base.value, val.value, val.name, this.selectedStoreNumber);
     console.log(this.selectedStoreNumber);
      var io=this.focusedManager.dashboardMap.get(this.selectedStoreNumber);
      var array=[];
      

      var possibilities=io.gridArray[0].filter((entry, index)=>{if(entry.value==base.value||entry.value==valz.value){ array.push(index, entry.value); return entry.value;}else{return false;}}); 
if(possibilities!=undefined&&possibilities[0]!=undefined&&possibilities.length!=0)
{
var keys=possibilities[0].key.split("_"); var row =parseInt(keys[2]);
    var valueObject=io.gridArray[15][row].valueObject;
    var keyz=Object.keys(valueObject);
    keyz.forEach((prop,i, arr)=>{if(valueObject[prop]=="--"){valueObject[prop]="";}});
    this.set("valueObject", valueObject);
    //console.log(this.valueObject);
    this.superValue=Object.assign(this.superValue, this.valueObject);
    console.log(this.superValue, this.valueObject);
         var count =this.inputsDisplayArray.length;
        console.log(count);
          for(var i=0;i<count;i++)
          {
            
               this.inputsDisplayArray[i].forEach((val, j, arr)=>{
                    if(this.superValue[val.nameA]!=undefined){this.set(["inputsDisplayArray",i,j,"valueA"],this.superValue[val.nameA]);}
                    if(this.superValue[val.nameB]!=undefined){this.set(["inputsDisplayArray",i,j,"valueB"],this.superValue[val.nameB]);} 
               });
          }


  }
}
},

  observeInputsDisplayArray(inputs){
      var vo={}, triple=this.focusedManager.propertiesLabelsAndValuesFromInputs(inputs);
      var valueObject=triple.name.reduce((vo, val,i)=>{ 
                    vo[val]="";
                    return vo;}, vo);
      this.set("valueObject", valueObject);
  },
  _computeSiblingHeight(childHeight){
    return childHeight;
       },

  attached(){
    var childHt= this.$.container1;
    this.root.addEventListener('dom-change', function() { var ht=window.getComputedStyle(childHt,null).getPropertyValue("height");}, this)
    this.set("interfaceType", "inputs");
    this.async(this.openDdr, 100);
    this.doStuffOnLoad(); 
  },

    submitHandler(event){
      //console.log(event, this.selectedStore)
  if(this.selectedStoreNumber==2){this.focusedManager.createIndexedDatabase(2);}
    else{
          var formResults = this.$.callIntakeForm.serialize();
            var keys=Object.keys(formResults);
            var trueForm=keys;
         var val=this.superValue;
         console.log(this.selectedStoreNumber);
            this.gridMakerFunction(this.chosen, trueForm, val, this.selectedStoreNumber);
              this.wipeCleanInputs();
            }
    },
    wipeCleanInputs(){
       var keyz=Object.keys(this.valueObject);
    keyz.forEach((prop,i, arr)=>{this.set(["valueObject",prop],"");});
        var keys=Object.keys(this.superValue);
    keys.forEach((prop,i, arr)=>{this.set(["superValue",prop],"");});
    },


    computePageNumber(selected){ return 2;},

    _computePageTotal(inputsDisplayArray, index){
     var pageTotal=(this.inputsDisplayArray.length+1);
   
     this.set("pageTotal", pageTotal);
     this.set("shadowIndex", this.selected+1);
    },


    observeChangeB(event, value, name){},

    observeChangeA(event, value, name){},


	_tapHandler(e){
		var targ=e.target;
		while(!targ.attributes.btn && targ.nodeName!=="FC-DDR-CARD")
		{
			targ=targ.parentElement;
		}
		if(targ.attributes.btn){
		this[targ.attributes.btn.value](e);
	   }
	},
	openDdr(){
		this.$.focusedCallInterface.falseClose();
		this.$.focusedCallInterface.falseClose();
	},
   _computePageNumber(index){
    // // console.log(index); 
    // var retVal = parseInt(index)+2;
  },
	

    
       rightClick: function() {
        this.entryAnimation = 'slide-from-left-animation';
        this.exitAnimation = 'slide-right-animation';
        
        
       this.selected = (this.selected === (this.inputsDisplayArray.length))? 0 : (this.selected + 1);
       
      },
      leftClick: function() {
        this.entryAnimation = 'slide-from-right-animation';
        this.exitAnimation = 'slide-left-animation';
        console.log(this.inputsDisplayArray, "look here");
       this.selected = this.selected === 0 ?(this.inputsDisplayArray.length-1): (this.selected - 1);
         
      },
      observerForSearch(isPreviousCaller, callerRole){
        if(isPreviousCaller===true){
             if("2".match(callerRole)){this.leftClick();this.leftClick();}
                  else{this.leftClick();}
        }
      },

_computeTimeStampUseful: function(timeStamp, callLogFormOneObject){
    var d = new Date();
    var n = -d.getTime();
    console.log(n);
    return n;

},
});

</script>

<!--
        // var count =this.inputsDisplayArray.length;
        // console.log(count);
        //   for(var i=0;i<count;i++)
        //   {
        //       var pageInputArray=this.inputsDisplayArray[i];
        //       var inputSetCount=pageInputArray.length;
        //        this.inputsDisplayArray[i].forEach((val, j, arr)=>{
        //             if(nv.base[val.nameA]!=undefined){this.set(["inputsDisplayArray",i,j,"valueA"],nv.value[val.nameA]);}
        //             if(nv.base[val.nameB]!=undefined){this.set(["inputsDisplayArray",i,j,"valueB"],nv.value[val.nameB]);} 
        //        });
        //   }
</dom-module>
