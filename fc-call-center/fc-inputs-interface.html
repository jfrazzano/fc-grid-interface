<link rel="import"  href="fc-form-routing-behavior.html">
<link rel="import" href="fc-course-calendar-creation-behavior.html">
<link rel="import"  href="fc-form-routing-behavior.html">
<link rel="import" href="../bower_components/iron-form/iron-form.html">
 <link rel="import" href="fc-calendar-behavior-beta-prime.html"> 
<link rel="import" href="../fc-grid/fc-grid-style-behavior.html">
<link rel="import" href="../fc-grid/fc-draggable-behavior.html">
<link rel="import" href="fc-profile-class.html">
<link rel="import"  href="fc-calendar-controller-behavior.html">






<link rel="import" href="../fc-grid/data-manager.html">
<link rel="import" href="../bower_components/paper-card/paper-card.html">
<link rel="import" href="../bower_components/paper-button/paper-button.html">
<link rel="import" href="../bower_components/neon-animation/neon-animated-pages.html">
<link rel="import" href="../bower_components/neon-animation/neon-animatable-behavior.html">
<link rel="import" href="../bower_components/neon-animation/neon-animation-runner-behavior.html">
<link rel="import" href="../bower_components/neon-animation/neon-animation-behavior.html">
<link rel="import" href="../bower_components/neon-animation/neon-animations.html">
<link rel="import" href="../bower_components/paper-listbox/paper-listbox.html">
<link rel="import" href="../bower_components/paper-icon-button/paper-icon-button.html">
<link rel="import" href="../bower_components/paper-item/paper-item.html">
<link rel="import" href="../bower_components/paper-radio-button/paper-radio-button.html">
<link rel="import" href="../bower_components/paper-radio-group/paper-radio-group.html">
<link rel="import" href="../bower_components/iron-image/iron-image.html"><!-- 
<link rel="import" href="../bower_components/firebase-element/firebase-collection.html"> -->
<link rel="import" href="../fc-grid/fc-iss-input.html">
<link rel="import" href="../fc-grid/fc-ddr-card.html">
<link rel="import" href="../fc-grid/data-manager.html">




<link rel="import" href="fc-textarea-buttons-form.html">


<!-- <link rel="import" href="fc-inquiry.html">
<link rel="import" href="fc-tabbed-card.html">
<link rel="import" href="fc-call-list-view.html">
<link rel="import" href="fc-call-item.html"> -->
<link rel="import" href="FC_frontpage_logo.png">
<link rel="import" href="fc-call-center-form-one.html">
<link rel="import" href="fc-call-center-form.html">
<link rel="import" href="../src/fc-grid.html">
<dom-module id="fc-inputs-interface">

<template>
<style>

:host{
      background: white
      border: silver 1px solid;
      height: 100%;
      width: 100%;
      margin-right: -19px;
     position: absolute;
      opacity: 1;
      overflow-x: hidden;
      @apply(--vertical-layout);
      @apply(--layout-flex);

      }
     
    .sidesLeft{
      height: 42px; width: 42px; color: #009; top: 42%; cursor: pointer;
    }
    .sidesRight{
      height: 42px; width: 42px; color: #009; top: 42%; cursor: pointer;
      }
      .intakeForm{
      	border: 1px #efefef solid;
      	margin: 12px 0px;
      }
     
		paper-button{
		 	 width: 50%;
		 	 min-width: 147px;
		 	 font-weight: 600; 	  
		 	 font-size: 14px;
		 	 text-align: center;
		 	 white-space: nowrap;
		 	 max-height: 36px;
		 	 @apply(--layout-nowrap);
		 	 background: white;
		 	 border: #efefef 1px solid;
		 }
		 paper-button.green{
		 	color: green; 
		 	border: 2px solid green;
		}
    fc-ddr-card{
      min-width: 40px;
      min-height: 40px;
      max-height: 600px;
      max-width: 580px;
    }
		paper-button.darkblue{
			color: #009;
			border: 2px solid #009;
		}
		paper-button.red{
			color: red;
			border: 2px solid red;
		}
		paper-button.orange{
			color: orange;
			border: 2px solid orange;
		}
		paper-button:hover, paper-button:active{
			box-shadow: 2px 4px 7px 2px; 

		} 
		paper-button.darkblue:hover, paper-button.darkblue:active{
			box-shadow: 2px 4px 7px 2px gold; 

		} 
		.buttonRow{
			@apply(--layout-flex);
			@apply(--layout-horizontal);
			padding: 2px;
		}

.slides{overflow: hidden; overflow-y: scroll;}

.one{
	font-family: merriweather; 
	font-weight: 600;
	color: #080808;
	font-size: 14px;

	white-space: nowrap;
	display: inline-block;
}
   
      neon-animated-pages {
        @apply(--layout-flex);
        @apply(--layout-horizontal)
        margin: 12px 0px 12px 0px
        padding: 18px;
        background: white;
        @apply(--layout-self-stretch);
        /*min-height: 1080px;*/
        height: 100%;
      }
      neon-animatable {
        color: white;
        @apply(--layout-horizontal);
        @apply(--layout-center-center);
        @apply(--paper-font-display3);
        margin: 0px;
        padding: 0px;
      }
    
    .subheading {
    font-size: 14px;
    color: brown;
    font-family: times;
 		float: right;
 		margin: 0px 12px;
    padding: 8px;
    }
 
    label.returningCaller{
    	color: black;
    	font-size: 16px;
    /*	font-style: italic;*/
    	font-weight: 700;
    }
  
    p{
    	text-indent: 36px;
    	font-size: 14px;
    	font-weight: 600;
    		}
  .setHeight {
    min-height: 68px;
    max-height: 980px;

    max-width: 485px;
    width: 320px;
    margin: 4px;
    padding: 4px;
  }
  

.timestamp{
    font-weight: 300;
    color: #009;

    font-family: merriweather;
   font-size: 13px;
    position: absolute;
    color: brown;
    font-family: times;
   top: 60px;
   left: 20px;
    }

  .subheading {
    font-size: 13px;
    position: absolute;
    color: brown;
    font-family: times;
   top: 36px;
   right: 14px;
   margin-right: 0px;
    }
     .bar{
    
      min-width:180px; 
      height: 2px;
      background:silver;
      @apply(--vertical-layout);
      @apply(--layout-flex);
      @apply(--layout-self-stretch);
      position: absolute;
      left: 22px;
      right: 22px;
      top: 54px;

    }

    .check{
			font-size:26px;
			color: green;
			position: absolute;
			left: 5px;
		}
	
	
    .headerCenter{
      font-size: 12px;
      font-weight: 300;
    }

		.show {display:block; z-index: 45; right: 0;}
  @media(max-width: 687px){
  	#content{
  		@apply(--layout-vertical);
  		@apply(--layout-center);
  	}

  	/*add more here*/
  }
  .innerContainer{
    max-height: 680px!important;
    height: 680px;
    overflow-y: scroll;
  }
  </style>
  <form is="iron-form" id="callIntakeForm" hidden$="{{_computeMinWidthHidden(currentInnerWidth)}}"  method="get" action="/">
 <div style="margin: 30px 0px -40px 20px; padding-bottom: 10px; z-index; 5; font-family: merriweather; line-height: .8;color: #009; font-size: 32px; font-weight: 300;"> <span  style="padding-bottom:2px;" on-tap="changeAppInterfaceForInputs" >{{chosen}}</span>
 
 <div class="vertical layout flex" style="margin-bottom: 48px;"">
    <section class="bar"></section>
      <section class="horizontal layout flex">
        <span class="timestamp">
        [[time]] on [[date]]
        </span>
       <span btn="leftClick" class="subheading">Page {{shadowIndex}} of {{pageTotal}}</span>
    </section>
</div>
</div>

 <div class="flex layout vertical center-justified innerContainer" style$="width:{{currentInnerWidth}}" hidden$="{{_computeMinWidthHidden(currentInnerWidth)}}">

        <neon-animated-pages id="pages" selected="{{selected}}" entry-animation="[[entryAnimation]]" exit-animation="[[exitAnimation]]">

            <div id="container1">
                <fc-call-center-form-one style="padding: 6px 18px 14px 18px; max-height: 640px; overflow-y: scroll;"  page-index="{{selected}}" search-off="{{searchOff}}" inquiry="{{inquiry}}" value-object='{{valueObject}}' id="childOne" current-height="{{childHeight}}">
                </fc-call-center-form-one>
            </div>
        
            <template is="dom-repeat" items="{{inputsDisplayArray}}">
                <div>
                    <fc-call-center-form value-object="{{valueObject}}" forms="{{forms}}" form-selected="{{formSelected}}"id="generalForm" style="max-height: 640px; overflow-y: scroll;" first-free-row="{{rowIndex}}" search-off="{{searchOff}}" id="ioForm" grid-display-array="{{gridDisplayArray}}" focused-manager="{{focusedManager}}" current-height="{{siblingHeight}}" page-number="{{computePageNumber(selected)}}" item-object="{{item}}" >
                    </fc-call-center-form>
                </div>
            </template>
        </neon-animated-pages>
    </div>
         
              <div style="border-top: solid 1px silver; width: 92%; overflow-x: hidden;" class="vertical layout flex center-justified">
                  <section class="next" style="color: brown; padding: 4px; font-size: 20px; float: right; text-align: right; " on-tap="rightClick">NEXT PAGE &#10148</section>
                        <section class="horizontal layout flex buttons" on-tap="changeAppInterfaceForInputs">
                     <!--  <paper-button class="flex-1 red" id="one" btn="wipeInputs">clear</paper-button>
                      
                              <paper-button class="darkblue" on-tap="submitHandler">Submit</paper-button> -->
                                </section>
              </div>
          </form>
   
    
</template>
<script>
FcInputsInterface=Polymer({
	is:"fc-inputs-interface",
		 behaviors:[Polymer.NeonAnimatableBehavior,
                Polymer.NeonAnimationBehavior,
                Polymer.NeonAnimationRunnerBehavior,
                FCBehaviors.FcCalendarOptionsSelectorBehavior,
                FCBehaviors.FcGridStyleBehavior, 
                // FCBehaviors.DraggableBehavior,
                FCBehaviors.FocusedDataManagerBehavior,
                FCBehaviors.FcCalendarControllerBehavior,
                FCBehaviors.FcFormDataRoutingBehavior],
          
        listeners: {"onload":"doStuffOnLoad",
                        },
        observers:['observerForSearch(isSearchRequired.isPreviousCaller, isSearchRequired.callerRole)', 'observeInputsDisplayArray(inputsDisplayArray)','deepObserveValueObject(valueObject.*)'],
    properties:{
      time:{
      type:Date,
      value:function(){
          var time=new Date().toLocaleTimeString();
          console.log(time);
          return time;
      },
      notify: true
    },
    date:{
        type: Date,
        value: function(){
          var date=new Date().toLocaleDateString();
          return date;
            },
        notify: true,
        },
      entryAnimation:{
          type: String,
          value: function(){ return "";},
          notify: true
        },
        shadowIndex:{
            type: Number,
            computed: "_computeShadowIndex(selected)",
            notify: true
        },
        exitAnimation:{
            type: String,
            value: function(){return "";},
            notify: true
        },
 
    valueObject:{
      type: Object,
      value: function(){return {};}, 
      notify: true,
    },
    superValue:{
      type: Object,
      value: function(){return {};},
      notify: true,

    },
 
    childHeight:{
        type: String,
        notify: true,
    },
    siblingHeight:{
        type: String,
        computed: "_computeSiblingHeight(childHeight)",
        notify: true,
    },
    searchOff:{
      type: Boolean,
      notify: true, 
      observer:"observeSearchOff",
     
    },
    currentWidth:{
      type:String,
      observer: "observeCurrentWidth",
      notify: true,
    },

    selected: {
          type: Number,
          value: function(){return 0;},
          notify: true,
          observer: "observeSelected",
        },
    hasFocusedProfile:{
      type: Boolean,
      value: function(){return false;},
      notify: true,
    },
    isFormSubmitted:{
        type: Boolean,
        value: false,
        notify: true
      },
    pageTotal:{
         type: Number,
            computed: "_computePageTotal(inputsDisplayArray)",
            notify: true
        },
   
  },//end of properties
		
  ready(){
   
  },
  observeSelected(nv, ov){
    if(nv){console.log(nv,ov);}


  },
  _computeShadowIndex(selected){
    return selected+1;
  },
  _computePageTotal(inputsDisplayArray){
    var retVal=inputsDisplayArray.length+1;
    return retVal;

  },
  _computeMinWidthHidden(cwidth){
      var retVal=(cwidth-20<215)?true: false;
      return retVal;
  },
  computePageNumber(){},
  computeIsSearchRequired(hasFocusedProfile){},
  observeSearchOff(nv, ov){if(nv){
      console.log(nv);}},
  observeCurrentWidth(newVal, oldVal){
      if(newVal){
        console.log(newVal, oldVal);

      }


  },

    deepObserveValueObject(nv, ov){ 
      if(nv&&nv.value&&nv.value.value){
       var keys =Object.keys(nv.value);
       console.log(nv.value.name);
       console.log(nv.value.value); 
       console.log(nv.base);
       var frank="superValue."+ keys[0];
       this.set(frank,nv.value.value);
       console.log(this.superValue);
       this.superValue=Object.assign(this.superValue,nv.base);
       var holder=this.valueObject;
       var sup=this.superValue;
       var array=[holder, sup];
       for(var i=0;i<2; i++){
        var po=array[i];
          var obj=this.focusedManager.reformProfileObject(po);
       
        
       var retVal =this.searchMatchSet(nv.value, nv.base);
        if(retVal!=undefined){
            var count =this.inputsDisplayArray.length;
        console.log(count);
          for(var i=0;i<count;i++)
          {
              var pageInputArray=this.inputsDisplayArray[i];
              var inputSetCount=pageInputArray.length;
               this.inputsDisplayArray[i].forEach((val, j, arr)=>{
                    if(nv.base[val.nameA]!=undefined){this.set(["inputsDisplayArray",i,j,"valueA"],nv.value[val.nameA]);}
                    if(nv.base[val.nameB]!=undefined){this.set(["inputsDisplayArray",i,j,"valueB"],nv.value[val.nameB]);} 
               });
          }

        }
      }
    }
  }, 

  doStuffOnLoad(e){
         this.async(function(){var ht=window.getComputedStyle(this.$.container1, null).getPropertyValue("height"); var wt=window.getComputedStyle(this.$.container1, null).getPropertyValue("width");//console.log(ht, wt);
          this.style.width="440px"; this.style.height="660px";}, 4);
        //console.log(window.getComputedStyle(this.$.container1, null).getPropertyValue("height"), e);
     },
searchMatchSet(valz, base){
if(this.superValue){
      var io=this.focusedManager.dashboardMap.get(this.selectedStoreNumber);
      var array=[];
      
      //TO DO MAKE GRID ARRAY 
       var p=0;
      for(p=0;p<io.gridArray.length;p++){
        var label=io.gridArray[p][0].value,
         name=valz.name,
         labelToMatch= this.focusedManager.propertyNameToLabel(name);
        if(labelToMatch==label || p>15)
        {break;}//the fifteen stops u from selecting a gradelevel and getting a random student
        }
      //add end of for after iffs
            var possibilities=io.gridArray[p].filter((entry, index)=>{if(entry.value==base.value||entry.value==valz.value){ array.push(index, entry.value); return entry.value;}else{return false;}}); 
      if(possibilities!=undefined&&possibilities[0]!=undefined&&possibilities.length!=0)
      {
      var keys=possibilities[0].key.split("_"); 
      var row =parseInt(keys[2]);

          var valueObject=io.gridArray[15][row].valueObject;//this is fcid, this should be made general to find fcid
          //console.log(valueObject);
          valueObject=new ProfileReformer(valueObject);
          //console.log(valueObject, valueObject);
          var keyz=Object.keys(valueObject);
         console.log(valueObject,keyz);
          keyz.forEach((prop,i, arr)=>{if(valueObject[prop]=="--"){valueObject[prop]="";}
            if(this.valueObject[prop]==""||this.valueObject[prop]==undefined){
              var properTee="valueObject."+prop;
              this.set(properTee, valueObject[prop])
            }
        });
          //this.set("valueObject", valueObject);
         // console.log(this.valueObject, valz, base, "got past the if possibilities");
          this.superValue=Object.assign(this.superValue, this.valueObject);
         // console.log(this.superValue, this.valueObject);
               var count =this.inputsDisplayArray.length;
             // console.log(count);
           if(this.superValue.name){
                  var frankensteinProperty="superValue."+this.superValue.name;
                this.set(frankensteinProperty, this.superValue.value);
                this.set("superValue.name","");
                this.set("superValue.value","");
              }
           if(this.superValue.undefined&&this.superValue.undefined.name){
                var frankEb="superValue."+this.superValue.undefined.name;
                var vag=this.superValue.undefined.value;
                this.set(frankEb, vag); 
                //console.log(this[frankEb], "frankenstein property");
                }
                var other=   "superValue."+"[object HTMLInputElement]";
           if(this[other]){
                var another=this[other].name;
                var valueThree=this[other].value;
                var nom="superValue."+another;
                //console.log(other, other, other, "other");
                this.set(nom,valueThree);
                }
                var newProfile=new ProfileReformer(this.superValue);
                this.set("superValue",{});
                this.set("superValue",newProfile);
                var propKeys=Object.keys(this.superValue);
              //  console.log(this.superValue, "this should be a clean version of the key value thing");
                for(var i=0;i<count;i++)
                {
                     this.inputsDisplayArray[i].forEach((val, j, arr)=>{
                          if(this.superValue[val.nameA]!=undefined){this.set(["inputsDisplayArray",i,j,"valueA"],this.superValue[val.nameA]);}
                          if(this.superValue[val.nameB]!=undefined){this.set(["inputsDisplayArray",i,j,"valueB"],this.superValue[val.nameB]);} 
                     });
                }


        }
       
      }
},

  observeInputsDisplayArray(inputs){
      var vo={}, triple=this.focusedManager.propertiesLabelsAndValuesFromInputs(inputs);
      var valueObject=triple.name.reduce((vo, val,i)=>{ 
                    vo[val]="";
                    return vo;}, vo);
      this.set("valueObject", valueObject);
  },
  _computeSiblingHeight(childHeight){
    return childHeight;
       },

  attached(){
    var childHt= this.$.container1;
    this.root.addEventListener('dom-change', function() { var ht=window.getComputedStyle(childHt,null).getPropertyValue("height");}, this)
    this.set("interfaceType", "inputs");
    this.async(this.openDdr, 100);
    this.doStuffOnLoad(); 
  },


    submitHandler(event){
      //console.log(event, this.selectedStore)
  if(this.selectedStoreNumber==2){this.focusedManager.createIndexedDatabase(2);}
    else{
          var formResults = this.$.callIntakeForm.serialize();
            var keys=Object.keys(formResults);
            var trueForm=keys;
         var val=this.superValue;
         console.log(this.selectedStoreNumber);
            this.gridMakerFunction(this.chosen, trueForm, val, this.selectedStoreNumber);
              this.wipeCleanInputs();
            }
     },


    wipeCleanInputs(){
         this.set("superValue",{});
          var pro=new ProfileReformer({});
          this.set("valueObject", pro);
          var count=this.inputsDisplayArray.length;
              for(var i=0;i<count;i++)
              {
               this.inputsDisplayArray[i].forEach((val, j, arr)=>{
                     this.set(["inputsDisplayArray",i,j,"value"],"");
                     this.set(["inputsDisplayArray",i,j,"valueA"],"");
                     this.set(["inputsDisplayArray",i,j,"valueB"],"");
                    });
               }
        },


    wipeInputs(e){
      this.wipeCleanInputs();
      
    },


    observeChangeB(event, value, name){},

    observeChangeA(event, value, name){},


	_tapHandler(e){
		var targ=e.target;
		while(!targ.attributes.btn && targ.nodeName!=="FC-DDR-CARD")
		{
			targ=targ.parentElement;
		}
		if(targ.attributes.btn){
		this[targ.attributes.btn.value](e);
	   }
	},
	openDdr(){
		// this.$.focusedCallInterface.falseClose();
		// this.$.focusedCallInterface.falseClose();
	},
   

    
       rightClick: function() {
        this.entryAnimation = 'slide-from-left-animation';
        this.exitAnimation = 'slide-right-animation';
        
        
       this.selected = (this.selected === (this.inputsDisplayArray.length))? 0 : (this.selected + 1);
       
      },
      leftClick: function() {
        this.entryAnimation = 'slide-from-right-animation';
        this.exitAnimation = 'slide-left-animation';
        console.log(this.inputsDisplayArray, "look here");
       this.selected = this.selected === 0 ?(this.inputsDisplayArray.length): (this.selected - 1);
         
      },
      observerForSearch(isPreviousCaller, callerRole){
        if(isPreviousCaller===true){
             if("2".match(callerRole)){this.leftClick();this.leftClick();}
                  else{this.leftClick();}
        }
      },

_computeTimeStampUseful: function(timeStamp, callLogFormOneObject){
    var d = new Date();
    var n = -d.getTime();
    console.log(n);
    return n;

},
layWaste(e){


  this.focusedManager.getReviseResaveAllBasicProfiles(0, "deleteDatabase", "build");

  }
    
});

</script>

<!--  <section class="horizontal layout flex around-justified">
     <span on-tap="leftClick" class="sidesLeft">&#8678;</span> 

<div class="headerCenter" on-tap="changeAppInterfaceForInputs">Tap Here </div>
    
          <span on-tap="rightClick"  class="sidesRight" style="cursor: pointer;">&#8680;</span>
      </section>
 -->
<!--
        // var count =this.inputsDisplayArray.length;
        // console.log(count);
        //   for(var i=0;i<count;i++)
        //   {
        //       var pageInputArray=this.inputsDisplayArray[i];
        //       var inputSetCount=pageInputArray.length;
        //        this.inputsDisplayArray[i].forEach((val, j, arr)=>{
        //             if(nv.base[val.nameA]!=undefined){this.set(["inputsDisplayArray",i,j,"valueA"],nv.value[val.nameA]);}
        //             if(nv.base[val.nameB]!=undefined){this.set(["inputsDisplayArray",i,j,"valueB"],nv.value[val.nameB]);} 
        //        });
        //   }
</dom-module>
