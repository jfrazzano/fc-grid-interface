<link rel="import" href="fc-draggable-behavior.html">
<link rel="import" href="fc-grid-style-behavior.html">
<link rel="import" href="data-manager.html">
<link rel="import" href="fc-grid-input-behaviors/fc-api-inputs-from-grids-behavior.html">
<link rel="import" href="fc-grid-input-behaviors/fc-grids-from-api-inputs-behavior.html">
<link rel="import" href="fc-grid-input-behaviors/fc-api-inputs-grid-navigation-behavior.html">
<link rel="import" href="../bower_components/iron-form/iron-form.html">
<link rel="import" href="../bower_components/iron-flex-layout/iron-flex-layout-classes.html">
<!-- <link rel="import" href="../bower_components/iron-flex-layout/classes/iron-shadow-flex-layout.html"> -->
<link rel="import" href="../bower_components/paper-dialog/paper-dialog.html">
<link rel="import" href="../bower_components/paper-dialog-scrollable/paper-dialog-scrollable.html">
<link rel="import" href="../bower_components/paper-button/paper-button.html">
<link rel="import" href="fc-iss-input.html">
<link rel="import" href="../bower_components/paper-listbox/paper-listbox.html">
<link rel="import" href="../bower_components/paper-item/paper-item.html">
<link rel="import" href="../fc-call-center/fc-call-center-dialog.html">
<dom-module id="fc-indexed-db-helper">
<template id="fc-indexed-db-helper">
<style>
:host{
	position: fixed;
	max-width: 300px;
	z-index:22;
	
};
paper-dialog{
	position: fixed;
	min-width: 20vw;
	min-height: 480px;
	max-height: 70vh;
	width: 360px;
	background: #aecefe;
	border-radius: 3px;
	border: solid: 2px #005c00;
	box-shadow: 4px 7px 13px 6px grey;
	resize: both;
	z-index: 2200;
}
paper-dialog-scrollable{
	min-width: 18vw;
	max-height: 55vh;
	overflow-y: scroll;
	border: solid 1px silver;
	background: white;


}
fc-iss-input{
	margin:26px 8px;
	font-family:merriweather;
	color: #005c00;
	font-size:1.2em;

}
</style>
  <fc-call-center-dialog id="ccdialog" data-arrays="{{dataArrays}}">
      </fc-call-center-dialog>
<paper-dialog id="idbHelper"  draggable drags no-cancel-on-outside-click always-on-top >
<section class="horizontal flex layout around-justified" style="max-height: 28px!important;">
       <span on-tap="_back">&#9664;</span> <paper-button on-tap="selectApi">{{chosen}}</paper-button><span on-tap="_forward">&#9654;</span>
    </section>
        <paper-dialog-scrollable>
        <form  id="callIntakeForm" method="get" action="/" is="iron-form">
          <p>
          <template is="dom-repeat" id="inputTemplate" items="{{selectedApiView}}">
        	<section class="horizontal layout container"> 
        		<span hidden$="{{computeItemHeaderHidden(item.headerA)}}" class="questionHeader">{{item.headerA}}.</span>  <span hidden$="{{computeItemHeaderHidden(item.headerB)}}" class="questionHeader">{{item.headerB}}.</span>
      		</section>
      		
      		<div class="horizontal layout flex wrap self-stretch around-justified">
          		<fc-iss-input class="left" id$="{{item.nameA}}_{{counter}}" iss-name="{{item.nameA}}" iss-label="{{item.labelA}}" iss-value="{{item.valueA}}" item-select-property="value" value="{{item.valueA}}" show-drop-button="{{_computeShowDropButton(item.dropdownItemsA, item.dropdownItemsB)}}" dropdown-items="{{item.dropdownItemsA}}"  name="{{item.nameA}}" on-change="enterDataFromInterface" multi-select="[[item.multiSelectA]]">
          		</fc-iss-input>
          		<fc-iss-input id$="{{item.nameB}}_{{counter}}" iss-name="{{item.nameB}}" iss-value="{{item.valueB}}" value="{{item.valueB}}" iss-label="{{item.labelB}}" item-select-property="value" show-drop-button="{{_computeShowDropButton(item.dropdownItemsB, item.dropdownItemsA)}}" on-change="enterDataFromInterface" name="{{item.nameB}}" class="right" dropdown-items="{{item.dropdownItemsB}}" multi-select="[[item.multiSelectB]]">
          		</fc-iss-input>
     		</div>
  		</template>
  		</p>
  		</form>
  		<section>
  		<paper-button on-tap="addOneMoreRow">add</paper-button>
        </section>
        </paper-dialog-scrollable>
        <div class="buttons"  style="padding: 0px 0px 28px 0px; min-height: 65px!important;">
          <paper-button style="height: 25px;" dialog-dismiss>Cancel</paper-button>
          <paper-button style="height: 25px;" dialog-confirm autofocus>OK</paper-button>
          <paper-button on-tap="submitHandler"> submit</paper-button>
          <paper-button addRo0w on 
        </div>
      </paper-dialog>
    
<!--style="height: 0px; width: 1px; opacity: 0; visibility: hidden;"-->
</template>
<script>
FcIndexedDbHelper=Polymer({
	is:"fc-indexed-db-helper",
	behaviors:[FCBehaviors.FcGridStyleBehavior, FCBehaviors.DraggableBehavior, FCBehaviors.FcApiInputsGridNavigationBehavior],
	observers:["observeChangeB(changeEventB.event, changeEventB.value, changeEventB.name)", "observeChangeA(changeEventA.event, changeEventA.value, changeEventA.name)"],
	
	properties:{
	
	changeEventA:{
      type:Object,
      value:function(){return {};},
      notify: true,
    },
    changeEventB:{
      type:Object,
      value:function(){return {};},
      notify: true,
    },
   
   
		apiLinked:{
			type: Object,
			notify: true,
		},
		
	
		//end api view Properties
		//begin api view inputs array sets

		indexeddbIndexArray:{
			type:Array,
			value:function(){return [];},
			// observer:"observeTheIndex",
			notify: true,
		},
	
	

	},

	_computeShowDropButton(dropItems, dropItemsB){
    var retVal=(dropItems!==false || dropItemsB!==false)?true: false;
    return retVal;
  },


	
	attached:function(){
	
	},

	
	openit(){
		this.$.idbHelper.opened=!this.$.idbHelper.opened;
		this.initializeApiArrays();
		 
	},

	enterDataFromInterface(e){
		//console.log(e, e.model.item);
		var inputSet=e.model.item;
		var arrayForInputPage=this.indexeddbIndexArray[this.itemsArraysIndex];
		arrayForInputPage.forEach(function(obj, i, array){
			var values=Object.values(obj);
				var index=values.indexOf(e.target.value);
				if(index>-1){
					var keys=Object.keys(obj);
					var key=keys[index];					
					this.set(["indexeddbIndexArray", this.itemsArraysIndex, key],e.target.value);
					obj[keys[index]]=e.target.value;
				}
		}, this);
	},


   submitHandler(event){
   		if(this.arrayIndex===this.tagIndex){this.set("sameThing", true);}
        this.set("formSubmitOne", true);
          var formResults = this.$.callIntakeForm.serialize();
            var d = new Date();
            var n = -d.getTime();
            var readableTime=new Date().toLocaleString();
         
          	this.gridMakerFunction(this.apiChoices[this.selectedApiIndex].apiName);
           		this.wipeCleanInputs();
          			// var objectTostore={"gridName": gridname, "api":"whateverTheInterfaceSays", "currentrow": Number};
			},

wipeCleanInputs(){this.set("counter", 0); this.initializeHelper();this.set("student",{});},


computeItemHeaderHidden(header){
    if(header){return false;}
    else{return true;}
  },

	 observeChangeB(event, value, name){
   // console.log(event, value, name);
     this.set(["student",name], value);
     console.log(this.student[name], this.student);

  },

observeChangeA(event, value, name){
    //console.log(event, value, name);
    this.set(["student",name], value);
    console.log(this.student[name], this.student);

  },



});
</script>
</dom-module>
