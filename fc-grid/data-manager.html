<link rel="import" href="../fc-call-center/fc-calendar-behavior-beta-prime.html">
<link rel="import" href="fc-grid-style-behavior.html">
<script>


//UTILITY FUNCTIONS
	//deep assign gets getters

function deepAssign(target, sources) {
  sources.forEach(source => {
    let descriptors = Object.keys(source).reduce((descriptors, key) => {
      descriptors[key] = Object.getOwnPropertyDescriptor(source, key);
      return descriptors;
    }, {});
    // by default, Object.assign copies enumerable Symbols too
    Object.getOwnPropertySymbols(source).forEach(sym => {
      let descriptor = Object.getOwnPropertyDescriptor(source, sym);
      if (descriptor.enumerable) {
        descriptors[sym] = descriptor;
      }
    });
    Object.defineProperties(target, descriptors);
  });
  return target;
}
function surfaceCopy(target, listOrArrayOfObjectsToStripOrderMatters){
	if(Array.isArray(listOrArrayOfObjectsToStripOrderMatters)){

    }

}

function methodAssignment(objectThatIsToBeExtended, funktionToAdd, rg1, [argArray]){
	Object.assign(objectThatIsToBeExtended, [objectThatIsToBeExtended].prototype[funktionToAdd]([argArray]));
}


function FcCurrentUserProfile(userParams, context){
    var type=userParams.type;
    var batchA=["FocusedProfile", "FocusedAdditionalAcademics","FocusedPastAcademics", "FocusedTestResults", "FocusedHomeworkResults","FocusedClassSchedule", "FocusedCourseSyllabus"];// "FcProgressCharting", "FcMessages", "FcCourseMessages", 
    var batchB=["FcInquirerTable","FcInquiry", "FcInquiries", "FcToDos", "FcCalendaring", "FcAvailableCourses","FocusedClientPaymentRecords"];
    var batchC=[];
    var batchD=[];
    var batchE=[];
    var arrayOfConstructors=(type==="studentOne")?batchA:(type==="callCenterOperator")? batchB.concat(batchA):(type==="coach")?batchA.concat(batchC):(type==="accountant")?batchD:(type==="admin")?batchA.concat(batchB, batchC, batchD, batchE): [];

}
function DataManager(user){
    this.fullName=user.fullName;
    this.fcid=user.fcid;
    this.type=user.type;
	this.dataManagerProfile={};
  
    this.arrayWorker=new Worker("indexedDbWorker.js");
       var addOns=this.getAddOns(); 
    this.profileConstructorArray= [FocusedProfile,FocusedPastAcademics,FocusedAdditionalAcademics];
    this.courseCalendarInputs=this.courseInputGetter();
     // this.getIdbProfiles();
    //console.log("courseCalendarInputs", this.courseCalendarInputs, "this should be the course calendar input set from teh static getters in the course calendaring class");
    //Below I strip profile properties from the three profile classes; I use the "addOns", to fix some mistakes made in early design related to multiselect in the dropddowns

    this.profileInputs=this.setPropertiesFromConstructorsToInitializeInputsForAnApi(this.profileConstructorArray, this.profileInputs, addOns);
    //console.log(this.profileInputs, "these should be the profile inputs");
    //good to here
    this.inquiryInputs=this.setPropertiesFromConstructorsToInitializeInputsForAnApi([FocusedInquiry],this.inquiryInputs,null, [["_", "_", "_", true]]);
    //console.log("these should be the inquiry inputs", this.inquiryInputs);
    //good to here
    this.gridMaker=new DataGrids({});
    this.shorthandIndex={};
    this.inputsIndex=[];
    //console.log(this.gridMaker, "this is gridMaker");
    this.dashboardMap=this.mappedDashboardDataset();
    this.getShorthandIndex();
  
    //issues with map consider plain object-- or object with array in it
    //fix dropdowns you tried to make more efficient
  console.log(this.profileInputs, this.courseCalendarInputs, this.inquiryInputs);
    this.multiGridArray=this.buildGridFromInputs(this.profileInputs, this.courseCalendarInputs, this.inquiryInputs, this.inputsIndex);
    var updater=this.multiGridArray;
    var keys=[0,1,2];
    var propertiesToUpdateForEachKey=["gridArray", "gridArray", "gridArray"];
    this.updateMappedDashboardDataset(updater, keys, propertiesToUpdateForEachKey);
    //console.log(this.dashboardMap); 
    this.getIdbProfiles();

       
        var databasesIndex={





        };
    }

 DataManager.prototype.courseInputGetter=function(){
    var inputs = FcCourse.getInputs();
    var retVal= this.calculateInputKeyAndValueArrayFromPrototypeOfClassStaticGetter(inputs);
    return retVal;

 }

 DataManager.prototype.calculateInputKeyAndValueArrayFromPrototypeOfClassStaticGetter=function(protoStaticGetter){
    var arrReturn=protoStaticGetter,it={},arrHolder=[];
    var keyValArrReturn= arrReturn.map(function(val,index){
        if(index%8===0){arrHolder=[];}//sets the 8 inputs a page
        var temp=val[1].label2;
        temp=temp.replace(/\s/g, "");
        var propertyName=temp.replace(temp.charAt(0),temp.charAt(0).toLowerCase()), label=val[1].label2, name=propertyName,dropdownItems=val[2].map(function(value,i,arr){var obj={};obj={"name": value, "value":value, "selectCheck": false}; return obj;}),multiSelect=(val[3])?val[3].multiSelect:false, ab=(index%2===0)?"A":"B";
        //setting ab allows a row of two inputs to be created for the dom-repeat
        var nameProp="name"+ab,labelProp="label"+ab,propertyNameProp="propertyName"+ab,dropdownItemsProp="dropdownItems"+ab, multiSelectProp="multiSelect"+ab;
        it[nameProp]=name,it[labelProp]=label,it[propertyNameProp]=propertyName,it[dropdownItemsProp]=dropdownItems;
        it[multiSelectProp]=multiSelect;
        if(index%2!==0){
            var holder=it;
            it={};
            arrHolder.push(holder);
            }
        //above uses sets one full object in an array that will be sent with 3 other object pairs to full a page (see directly below)
            if((index+1)%8===0){return arrHolder;}
            else{ return false;} //false allows for the easy filtering of the mapped array, in the chained function below/we are only 1 in 8 of the array "slots" for the new array; so array is not sparse, filter ;-)
        }).filter(function(val){return(val!==false)});
 
    return keyValArrReturn;
  }
  DataManager.prototype.setPropertiesFromConstructorsToInitializeInputsForAnApi=function(argArray, api, addOns, args){
        var argContstructorArray=argArray;
        if(api==null){api={};}
        var addOnObj=addOns;
        //console.log(addOnObj, addOns);
        var newObject=argContstructorArray.reduce((pre,constructor, i, array)=>{
            //console.log(pre, constructor, array, i);
                var a=(args&&args[i].length>0)?args[i]:{};
                var obj=new constructor(a);
                api=Object.assign(api, obj);
                return api;
                }, this);
        var keysOne=Object.keys(newObject);
        var it={};
        var arrayAb=[];
        var pageArray=[];
        keysOne.forEach(function(val, index, array){
            length=array.length;
            var label=val.replace(/([A-Z])/g, ' $1'),  
            label=label.replace(/^./, function(label){ return label.toUpperCase(); }),
            label=label.replace("1", " One"),
            label=label.replace("2", " Two");
            var ab=(index%2===0)?"A":"B",nameProp="name"+ab,labelProp="label"+ab,propertyNameProp="propertyName"+ab,dropdownItemsProperty="dropdownItems"+ab, multiSelectProperty="multiSelect"+ab,labelIsAb="isAb"+ab;
            //built up the franken-it object now gonna use it to run sixty input objects! wish i ordered the data more consistently earlier....
            it[labelProp]=label,it[nameProp]=val,it[propertyNameProp]=val, it[dropdownItemsProperty]=(Array.isArray(newObject[val]))?"value":(val.selectedItems)?val.selecteditems:false; it[labelIsAb]=ab; 
            var mapName=val;
            if(it[dropdownItemsProperty]=="value")
            {
                it[dropdownItemsProperty]=[];
                it[dropdownItemsProperty]=newObject[val].map(function(item){ 
                      var retVal={"name": mapName, "value": item}; 
                      return retVal;
                  });
            };
            if(addOnObj!=null){
            var adds=addOnObj[val];
            //inject input properties not found or derivable from class constructors 
                if(adds){
                    var propObj={};
                    var keys=Object.keys(adds); 
                    keys.forEach((key)=>{
                        var newKey=key+it[labelIsAb];
                        propObj[newKey]=adds[key];
                    });
                    it=Object.assign(it,propObj);
                }
            }
            //add dynamic bound functions here
        var count=index+1;
        if(count%2==0)
        {
            pageArray.push(it);
            it={};
        }
        if((count)%8==0 || array.length-1===index)
        {
            arrayAb.push(pageArray);
            pageArray=[];
            it={};
        }
         });

           var retArray= arrayAb;
           this.intakeInputs=arrayAb;
        
           return retArray;
}
DataManager.prototype.propertyNameToLabel=function(propertyName){
    var label =propertyName;
            label=label.replace(/([A-Z])/g, ' $1'),  
            label=label.replace(/^./, function(label){ return label.toUpperCase(); }),
            label=label.replace("1", " One"),
            label=label.replace("2", " Two");
            return label;
}
DataManager.prototype.labelToPropertyName=function(label){
    var propertyName=label;        
        propertyName = propertyName.replace(" ", "");
        propertyName[0] = propertyName[0].toLowerCase();
        propertyName = propertyName.replace("one", "1");
        propertyName = propertyName.replace("One", "1");
        propertyName = propertyName.replace("two", "2");
        propertyName = propertyName.replace("Two", "2");
        return propertyName;
}

  DataManager.prototype.getAddOns=function(valuesFromInputs){
        if(valuesFromInputs!=undefined){/*do stuff*/}
        var arrayOfAddOns=[];
        var propertyAddOns={"property": undefined, "selectCheck": false, "isMultiSelect":false, "isMenu":false, "menuesPerRow": undefined, "calculateAtView": false, "methodOfCalculation": undefined, "searchOff": false};
        var listOfProps=[{property:"completedScienceCourses",  "selectCheck": true, "isMultiSelect": true, "searchOff":true}, {property:"completedMathCourses", "selectCheck": true, "isMultiSelect": true, "searchOff":true}, {property:"completedEnglishCourses", "selectCheck": true, "isMultiSelect": true, "searchOff":true}, {property:"completedHistoryCourses", "selectCheck": true, "isMultiSelect": true, "searchOff":true},{property:"pastTestDates", "selectCheck": true, "isMultiSelect": true, "searchOff":true}, {property:"approachingTestDates", "selectCheck": true, "isMultiSelect": true, "searchOff":true}]; 
        var object={};
        listOfProps.forEach((key,i, arr)=>{
            object[key.property]= key;
            //console.log(object, object[key]);
        });
        //console.log(object, "here is your little property maker");
        return object;
  }
  DataManager.prototype.localSave=function(obj){

    // this.arrayWorker.postMessage({"operation":"createApiDatabases", "data":obj});
    //this.gridWorker.posrMessage({"operation": "createApiDatabases"})
    this.arrayWorker.postMessage({"operation": "saveToFirebaseWithFanout", "data": obj});
  
  }
  
DataManager.prototype.mappedDashboardDataset=function(args){
    if(args==undefined || args==null){
        //console.log(this.courseCalendarInputs, this.profileInputs, this.inquiryInputs);
var array=[ 
            {"value": "Profiles","dbName": "Profiles","version": 3,  "storeName":"studentProfiles","tag":"studentIntakes", "inputsIndex":0, "displayIndex":0, indicies: ["studentFirstName", "studentLastName", "parent1FirstName", "parent1LastName", "parent2FirstName", "parent2LastName", "studentEmail",  "studentTelephone", "parent1Email",  "parent1Telephone", "parent2Email",  "parent2Telephone"], inputsArray:this.profileInputs, gridArray:[], archive: []},
                    {"value": "Course Calendars", "storeName": "courseCalendars", version: 2, "dbName": "Course", "tag": "calendarsAtCourseSignUp", indicies: ["coach", "time"], "inputsIndex": 1, "displayindex": 1, inputsArray: this.courseCalendarInputs, gridArray:[], archive: []},
                    {"value": "All Messages", "dbName": "callCenter", version: 4, "storeName": "allMessages","tag": "dailyMessageList", "inputIndex": 2, "displayIndex": 2, inputsArray: this.inquiryInputs, gridArray:[], archive: []},
                    {"value": "Homework Results", "dbName": "studentResults", version: 1, "storeName": "homeworkResults","tag": "byPercentCorrect", "inputIndex": 4, "displayedIndex": 3, inputsArray:[], gridArray:[], archive: []},
                    {"value": "Test Results", "dbName": "studentResults", version: 1, "storeName": "testResults","tag": "byImprovementTotal", "inputIndex": 3, "displayedIndex": 4, inputsArray:[], gridArray:[], archive: []},
                    {"value": "Intakes", "dbName": "callCenter", "storeName": "callIntakes", version: 1, "tag": ["shortFormProfile", "messageDetails", "eachFieldTextSearch", "smartContentSearch"], "inputIndex": 6, "displayIndex": 5, inputsArray:[], gridArray:[], archive: []},
                    ];
            var myMap=new Map();
            array.forEach((val, i, arr)=>{
                var key=val.dbName+"_"+val.storeName;
                myMap.set(key,val);
                myMap.set(i, val);
            });
        this.databaseIndex=array;
    }
    return myMap;
}
DataManager.prototype.getReviseResaveAllBasicProfiles=function(key, reactionFunction, reactFunction){
    var dbm=this.dashboardMap.get(key);
    var grid=dbm.gridArray;

    console.log(grid);
    var theProfiles=grid[15].map((cel, index)=>{ 
if(index>0&&cel.valueObject){
    var profile= new ProfileReformer(cel.valueObject);
        return profile;}}); 
    var array=[]; 
    var k = theProfiles.filter((pro, index)=>{var retVal=(pro==undefined||!pro.studentFirstName||pro.studentFirstName=="" || pro.studentFirstName==undefined||pro.studentFirstName==" " || pro.studentLastName==" "||pro.studentLastName==undefined|| pro.studentLastName=="" || pro.fcid=="" || pro.fcid==undefined || pro.fcid==="00001")?false: true; 
        if(retVal===false){return false;}else{
            if(index===0){console.log("useless?"); return false;}
            if(array&&pro){
                var dex=array.indexOf(pro.fcid); 
                if(dex>=0){retVal=false;
                }
                else{ array.push(pro.fcid);
                  console.log(array);
                  return true;
                } 
              }
            } 
         });
            console.log(k, theProfiles, "right here is where you check then you set key")
        var noms=["Course", "[object, Object]", "indexOfDatabases"];
        var obj={"requestType":"deleteDatabase", "names":noms};
        this.createIndexedDatabase(key,k, this.arrayWorker, "postMessage", obj, "build");
}




DataManager.prototype.getShorthandIndex=function(){
    var counter=0;
    var holderArray=[];
    this.dashboardMap.forEach((val, i, array)=>{
        //console.log(array);
         var retVal=(i%2===0)?val:undefined;
         //console.log(retVal);
        if(retVal){
            this.shorthandIndex[counter]={
                    "index": counter,
                    "value": val.value,
                    "dbName": val.dbName, 
                    "storeName":val.storeName,
                    "version": val.version, 
                    "inputsArray": val.inputsArray, 
                    "gridArray": val.gridArray
                };
            this.inputsIndex.push(val);
                counter++;
             }
        });
}
 DataManager.prototype.buildGridFromInputs=function(pi, cci, calli, store){

    var piLinda=store[0];
    var inputs=[pi,cci, calli];
    var type=["profilesSerialized", "courseCalendarsSerialized", "inquiriesSerialized"];
    var holderArray=[];
    var headersPlus=[];
    for(var j=0; j<inputs.length; j++){
            headersPlus=this.propertiesLabelsAndValuesFromInputs(inputs[j], type[j]);
        var columns=headersPlus.label.length;
        var holder= this.gridMaker.gridConstructor([columns,40,store[j].storeName, store[j].dbName, [headersPlus.label],1, null, headersPlus.val, undefined, undefined, undefined,undefined, true]);
           holderArray.push(holder);
           headerPlus=[];
           holder=[];
        }
        return holderArray;
 }

DataManager.prototype.propertiesLabelsAndValuesFromInputs=function(inputs, type){
           var pre={}; 
                pre.val=[]; 
                pre.label=[];
                pre.name=[];

          var headersPlus=inputs.reduce((arr,ar, index, array)=>{
                arr=arr.concat(ar);
            return arr;
                },[]).reduce((pre, obj)=>{         
                            var label=[obj.labelA,obj.labelB];
                            pre.label=pre.label.concat(label);
                            var val=[obj.valueA, obj.valueB];
                            pre.val=pre.val.concat(val);
                            var name=[obj.nameA, obj.nameB];
                            pre.name=pre.name.concat(name);
                            return pre;
                            }, pre);
        this[type]=headersPlus;
        return headersPlus;
}


 DataManager.prototype.updateMappedDashboardDataset=function(values, keys, propertiesForKeys){

    for(var i=0;i<values.length; i++){
        var map=this.dashboardMap.get(keys[i]);
        map[propertiesForKeys[i]]=values[i];
        this.dashboardMap.set(keys[i], map);

         var key2=[map.dbName, map.storeName, map.version];
        //console.log(key2);
    }

 }

 DataManager.prototype.getIdbProfiles=function(){
        //  this.propertiesLabelsAndValuesFromInputs()
        var profileData=[this.profilesSerialized, this.multiGridArray[0]];
    this.arrayWorker.postMessage({data:profileData, requestType: "getDatabase", dbName: "Profiles", storeName: "studentProfiles", version: 3} );
    this.arrayWorker.onmessage=(e)=>{
     if(e.data.returnMessage=="databaseReturn"){
                 var req=e.data;    
                    //console.log(req.data, req.dbName, req.version, req.storeName);
                    var profiles=this.dashboardMap.get(0);
                    profiles.gridArray=req.data;
                    this.dashboardMap.set(0, profiles);
                    this.multiGridArray[0]=[];
                    this.multiGridArray[0]=req.data;
                   // var profiles2=this.dashboardMap.get([req.dbName, req.storeName, req.version]);
                   //  console.log(profiles2.gridDisplayArray, profiles2);
                }


    };
}

DataManager.prototype.getIdbDatabaseDataAndLoadToGrid=function(serialized, dashboardMapEntry, dashboardMapEntryNumbKey){
    var dataArray=[serialized, dashboardMapEntry.gridArray];
     this.arrayWorker.postMessage({data:dataArray, requestType: "getDatabase", dbName:dashboardMapEntry.dbName , storeName: dashboardMapEntry.storeName, version: dashboardMapEntry.version});
     this.arrayWorker.onmessage=(e)=>{
        if(e.data.returnMessage=="build"){
            var retData=e.data.data;
            var dashEntry=this.dashboardMap.get(dashboardMapEntryNumbKey);
            dashEntry.gridArray=retData;
            this.dashboardMap.set(dashboardMapEntryNumbKey, dashEntry);
            }
        };
    }
DataManager.prototype.objectUpdatesToIdb=function(dashboardMapEntry, data){
             this.arrayWorker.postMessage({data:data, requestType: "updateObjectStoreWithNewObjects", dbName:dashboardMapEntry.dbName , storeName: dashboardMapEntry.storeName, version: dashboardMapEntry.version});
     this.arrayWorker.onmessage=(e)=>{
            var arg=e.data; if(arg.returnMessage=="gridToBePlaced"){ var key=arg.dbName+"-"+arg.storeName; var oi=this.dashboardMap.get(key); oi.gridArray=arg.newGrid; this.dashboardMap.set(key, oi);
        }
        console.log("great new grid");



        };
}
DataManager.prototype.createIndexedDatabase=function(key, data, context, responseFunction, responseArgObject, messageTrigger){
    var io=this.dashboardMap.get(key)
    this.arrayWorker.postMessage({"requestType":"createIndexedDb", "dbName": io.dbName, "storeName": io.storeName, "data": data, key: "fcid", fcid: "fcid", "version": io.version, "indicies":io.indicies, "data": data, key: "fcid"});
    this.arrayWorker.onmessage=function(e){ 
             if(e.data.returnMessage==messageTrigger){
                context[responseFunction](responseArgObject);

            }
        };

}
DataManager.prototype.reformProfileObject=function(profileObject){

    var tempObj=new ProfileReformer(profileObject);
   var keys=Object.keys(tempObj);
        var unfilled=keys.reduce((pre, key, i, array)=>{
                tempObj[key]=="";
                pre=pre+1;
                console.log("THIS "+key+ " " +tempObj[key]+ " " +pre +"MANY Properties Have Not Been Filled");
                return pre;
        },0);

        var retObj={"profile":tempObj,"unfilledProperties":unfilled};
        return retObj;
}

'use strict';
class ProfileReformer{
constructor(args){
        this.studentFirstName= args.studentFirstName ||"";
        this.studentLastName= args.studentLastName ||"";
        this.studentTelephone= args.studentTelephone ||"";
        this.studentEmail= args.studentEmail || "";
        this.parent1FirstName= args.parent1FirstName ||"";
        this.parent1LastName= args.parent1LastName || "";
        this.parent1Telephone= args.parent1Telephone ||"";
        this.parent1Email= args.parent1Email ||"";
        this.parent2FirstName= args.parent2FirstName ||"";
        this.parent2LastName=args.parent2LastName || "";
        this.parent2Telephone= args.parent2Telephone ||"";
        this.parent2Email= args.parent2Email ||"";
        this.addressLine1= args.addressLine1 ||"";
        this.addressLine2= args.addressLine2 ||"";
        this.studentFullName=args.studentFirstName + " " + this.studentLastName  || "";
        this.parent1FullName=args.parent1FirstName + " " + this.parent1LastName || "";
        this.parent2FullName=args.parent2FirstName + " " + this.parent2LastName || "";
        this.fcid= args.fcid || args.studentLastName + this.studentFirstName + "_00001"; 
        this.completedMathCourses = args.completedMathCourses || "";
        this.completedEnglishCourses = args.completedEnglishCourses || "";
        this.completedScienceCourses= args.completedScienceCourses || "";
        this.completedHistoryCourses = args.completedHistoryCourses || "";
        this.gradeLevel = args.gradeLevel||"";
        this.currentSchool = args.currentSchool ||"";
        this.previousEducation = args.previousEducation || "";
        this.educationalAspirations = args.educationalAspirations || "";
        this.startMathScore = args.startMathScore  || "";
        this.startReadingScore = args.startReadingScore  || "";
        this.startTotalScore = args.startTotalScore  || "";
        this.goalTotalScore = args.goalTotalScore || "";
    }
}
class Person{
    constructor(args){
     this.personFirstName= args.personFirstName ||"";
        this.personLastName= args.personLastName ||"";
        this.personTelephone= args.personTelephone ||"";
        this.personEmail= args.personEmail || "";           
        this.personFullName=this.personFirstName + " " + this.personLastName  || "";
        this.personFcid=this.personLastName+this.personFirstName+"_00001";
    }
    personToUserTypeConvertor(userType, studentFcidIfAvailable){
        var keys=Object.keys(this),type=userType, replacer="", typedKey="", a=(type!=="student"), b=true;
        var typedObject=keys.reduce((obj,key)=>{
                                    b=(a||key!=="personFcid");
                                    replacer=b?type:key.toLowerCase(), replacer;
                                    typedKey=key.replace("person", replacer);
                                    obj[typedKey]=this[key];
                                    return obj;
                        }, {});//this creates the typedObject to be inserted in an arg[property]--constructor or reformer;
        }
}
class DataGrids{
  constructor(bindTo){
    this.firstLoad=true;
    this.counter=0;
    this.dataArrays=[];
    this.indexOfDatabases=[];
    this.csv=[[  "Monthly Comparisons","January" ,"February" ,"March" ,"April" ,"May" ,"June" ,"July" ,"August" ,"September" ,"October","November" ,"December","Monthly Avg","%_v_Prev","Yr. Tot. Est 14"],
            ["2008 Totals",,,,,,,,,,,,,"$11,426.42 ",,"$137,117.00 "],
            ["2009 Totals","39.79%",,,,,,,,,,,,"$16,064.58 ","40.59%","$192,775.00 "],
            ["2010 Totals",,,,,,,,,,,,,"$25,997.08 ","61.83%","$311,965.00 "],
            ["2011 Totals","$31,454.86 ","$17,363.07 ","$36,275.98 ","$18,214.92 ","$9,891.99 ","$52,962.60 ","$70,732.42 ","$70,482.71 ","$30,910.19 ","$45,635.75 ","$10,225.00 ","$29,020.00 ","$35,264.12 ","35.65%","$423,169.49 "],
            ["2012 Totals","$51,545.00 ","$30,709.50 ","$9,300.00 ","$51,240.00 ","$53,762.50 ","$74,445.00 ","$101,800.00 ","$69,150.00 ","$45,700.00","$52,008.00 ","$38,220.00","$25,468.75 ","$50,279.06 ","42.58%","$603,348.75 "],
            ["2013 Totals","$70,942.00 ","$31,962.00 ","$59,400.00 ","$86,950.00 ","$55,025.00 ","$76,750.00 ","$148,334.00 ","$68,242.00 ","$51,399.00 ","$62,282.00 ","$51,000.00 ","$66,633.00 ","$69,076.58 ","37.39%","$828,919.00 "],
            ["2014 Totals","$78,600.00 ","$75,058.00 ","$84,675.00 ","$110,091.00 ","$92,055.00 ","$77,375.00 ",,,,,,,"$86,309.00 ","35.91%","$1,126,578.34 "],
            ["Avg. Revenue '11-'14","$58,135.47 ","$38,773.14 ","$47,412.75 ","$66,623.98 ","$52,683.62 ","$70,383.15 ","$106,955.47 ","$69,291.57 ","$42,669.73 ","$53,308.58 ","$33,148.33 ","$40,373.92 ","$60,232.19 ",,"$722,786.31 "],
            ["% Change 14 v. Avg. '11-'14","35.20%","93.58%","78.59%","65.24%","74.73%","9.93%","-100.00%","-100.00%","-100.00%","-100.00%","-100.00%","-100.00%","43.29%",,"#REF!"],
            ["Best Month '11-'13 yr. ","$70,942.00 ","$31,962.00 ","$59,400.00 ","$86,950.00 ","$55,025.00 ","$76,750.00 ","$148,334.00 ","$70,482.71 ","$51,399.00 ","$62,282.00 ","$51,000.00 ","$66,633.00 ","$69,263.31 ",,"$900,423.02 "],
            ["% change 14 v. previous best '11-'13","10.79%","134.84%","42.55%","26.61%","67.30%","0.81%","-100.00%","-100.00%","-100.00%","-100.00%","-100.00%","-100.00%","24.95%",,"-7.94%"],
            [ "Avg. Revenue '12-'14","$67,029.00 ","$45,909.83 ","$51,125.00 ","$82,760.33 ","$66,947.50 ","$76,190.00 ","$125,067.00 ","$68,696.00 ","$48,549.50 ","$57,145.00 ","$44,610.00 ","$46,050.88 ","$65,006.67 ",,"$780,080.04 "],
            ["%Change14 v.14 Avg","17.26%","63.49%","65.62%","33.02%","37.50%","1.56%","-100.00%","-100.00%","-100.00%","-100.00%","-100.00%","-100.00%","32.77%",,"6.26%"],
            ["Gross delta '13 to '14","$7,658.00 ","$43,096.00 ","$25,275.00 ","$23,141.00 ","$37,030.00 ","$625.00" ,"($148,334.00)","($68,242.00)","($51,399.00)","($62,282.00)","($51,000.00)","($66,633.00)","$27,240.00 ",,"$326,880.00 "],
            ["% &#916 13 to '14","10.79%","134.84%","42.55%","26.61%","67.30%","0.81%","-100.00%","-100.00%","-100.00%","-100.00%","-100.00%","-100.00%","44.76%",,"54.18%"],
            ["Projections RE: 2014","January" ,"February" ,"March" ,"April" ,"May" ,"June" ,"July" ,"August" ,"September" ,"October","November" ,"December","Monthly Avg","%?'14 v 13","Totals"],
            ["Worst Remaining M. (WRM) '12+","$78,600.00 ","$75,058.00 ","$84,675.00 ","$110,091.00 ","$92,055.00 ","$74,445.00 ","$101,800.00 ","$68,242.00 ","$45,700.00 ","$52,008.00 ","$38,220.00 ","$25,468.75 ","$70,530.23 ","2.10%","$846,362.75 "],
            ["Proj.WRMonths_incQ4 +17%","$78,600.00 ","$75,058.00 ","$84,675.00 ","$110,091.00 ","$92,055.00 ","$87,100.65 ","$119,106.00 ","$79,843.14 ","$53,469.00 ","$60,849.36 ","$44,717.40 ","$29,798.44 ","$76,280.25 ","10.43%","$915,362.99 "],
            ["Proj./w_last +15%","$78,600.00 ","$75,058.00 ","$84,675.00 ","$110,091.00 ","$92,055.00 ","$88,262.50 ","$170,584.10 ","$78,478.30 ","$59,108.85 ","$71,624.30 ","$58,650.00 ","$76,627.95 ","$86,984.58 ","25.92%","$1,043,815.00 "],
            ["Projected w last+25%","$88,677.50 ","$39,952.50 ","$74,250.00 ","$108,687.50 ","$68,781.25 ","$95,937.50 ","$185,417.50 ","$85,302.50 ","$64,248.75 ","$77,852.50 ","$63,750.00 ","$83,291.25 ","$86,345.73 ","25.00%","$1,036,148.75 "],
            ["Proj. w/Avg. 12-13","$78,600.00 ","$75,058.00 ","$84,675.00 ","$110,091.00 ","$92,055.00 ","$76,190.00 ","$125,067.00 ","$68,696.00 ","$48,549.50 ","$57,145.00 ","$44,610.00 ","$46,050.88 ","$75,565.61 ","9.39%","$906,787.38 "],
            ["2014 Projections" ,"January" ,"February" ,"March" ,"April" ,"May" ,"June" ,"July" ,"August" ,"September" ,"October","November" ,"December","Monthly Avg","%? v. Proj.","2014 Proj."],
            ["2014 Actual ","$78,600.00 ","$75,058.00 ","$84,675.00 ","$110,091.00 ","$92,055.00 ","$77,375.00 ",,,,,,,"$86,309.00 ","8.73%","$1,126,578.34"],
            ["? '14 v. + 25%","($10,077.50)","$35,105.50 ","$10,425.00 ","$1,403.50 ","$23,273.75 ","($18,562.50)",,,,,,,"$6,927.96 ","8.73%","$90,429.59"]
           ];
    this.defaultFormat={"color": "#009", "background": "#fefefe", "header_backgroundColor":"aliceblue", "fontSize": "14px", "fontWeight": "600", "fontFamily": "merriweather", "lineHeight": "1.15","line-height":"1.3em", "border": "1px #afafaf solid","styleText": "margin:0px; box-shadow: 1px 3px 4px 2px #fafafa; cursor: cell;font-size: 12px; font-weight: 600; color: #009; font-family: merriweather; text-align: center; white-space: wrap; max-height: 65px; min-height: 18px; border: 1px solid #afafaf; padding-top: 4px; font-family: merriweather; text-align: center;resize:none; line-height:1.1em;background: white;"};
    this.june2015CallSheet=[["6/1/2015", "Ram Lattupally",  "Saketh",  "sophmore"  ,"Monroe Twp HS", "908-239-2233",  "rdreddy116@gmail.com","tue/thurs class"],["6/1/2015", "Mary Coscia", "Matthew",  "sophmore",  "Metuchen HS", "732 494-3751",  "immdc@aol.com",  "sat class"],["6/1/2015", "Mattu Meera"  ,"Juhi",   ,   ,"732-987-9797", ,   "sat class"],["6/1/2015", " Cindy Prestigiacomo", "Jaime",   , "colts neck hs",   "917-750-0552",  "jprestir@aol.com",  "august sat class"],["6/1/2015", " Yelena ,Buryan", "Nicole Zatserkovaniy",  "sophmore",  "colts neck hs",  "617-832-5129",  "yburyan@yahoo.com august sat class"],["6/1/2015", "Rana Hemendra", "Kajal", "sophmore",  "Biotechnology HS",  "862-823-1888",  "hcrana@yahoo.com",  "sat class"]
    ];
    this.defaultHeader={"max-height": "65px;","border": "solid 1px #009;", "min-height": "18px;","line-height":"1.3em", "margin": "0px;", "height":"20px!important;", "font-family":"merriweather;", "background": "#f0f8ff;", "color": " #009;", "text-align": "center;", "font-size": "17px;","font-weight":"700;", "resize":"none;","styleText":"max-height: 65px; border: solid 1px #009; min-height: 18px;  margin: 0px;  height:23px!important;  font-family: merriweather; color:  #009;  text-align: center; line-height:1.3em; font-weight:700; resize:none; background: #f0f8ff;"};
      
    this.defaultColor="#009";    
     this.defaultHeaderbackground="#F0F8FF";
    this.monthsCalendarHeaderClass="daysOfTheWeekHeader";
    this.monthsCalendarCellClass="calendarDays";

    var calStyle=this.defaultFormat.styleText+"min-width: 100px!important;max-width: 101px!important; min-height: 100px;!important; max-height:101px!important;";
    var calHeaderStyle="border: solid 2px #009; height: 24px!important;  margin: 0px; font-family:courier;  background: aliceblue;  color:  #005c00;  text-align: center; line-height:1.3em; font-size: 17px; font-weight:300; resize:none;"
    this.financialGrid =this.gridConstructor([25,25,"mid2014Monthlies", "fcFinancials", undefined,1, undefined, this.csv, null, null, null, null, true]);
    this.calendarGrid=this.gridConstructor([7,7,"monthsCalendar", "fcCalendar", [["Sunday", "Monday", "Tuesday", "Wednesday","Thursday", "Friday", "Saturday"]],3, undefined, [["--",1,2,3,4,5,6],[7,8,9,10,11,12,13],[14, 15,16,17,18,19,20],[21,22,23,24,25,26,27,28,29],[30,31]], calStyle,null, calHeaderStyle,null, true]);
    this.fcCallRecords =this.gridConstructor([9,80,"June2015Calls", "fcCallRecords", [["Date", "Parent Name","Student Name","Year","School","Phone Number","Email","Stated Interest"]],12, undefined, this.june2015CallSheet, null, null, null, null, true]);
    this.courseResultsByStudent=this.gridConstructor([18,30,"stacyClassSheetJuneTTH900AM", "fcCourseResultsByStudent", undefined,3,undefined, undefined, null, null, null, null, null, true]);
     if(this.firstLoad===true){this.firstLoad=false;

     //  this.dataArrays=this.dataForPresetDatabases();
     //   console.log(this.dataArrays);
     //    this.indexOfDatabases=this.createIndicies(this.dataArrays);
     // this.initDatabasesAndObjectStoresOnFirstLoadToStystem(this.indexOfDatabases);
     //initDatabasesAndObjectStoresOnFirstLoadToStystem(){};

    }

    Object.defineProperty(this, "dataArrays", {
        enumerable: true,
        get : function ( ) {
            return bindTo.value;
        },
        set : function ( val ) {
            bindTo.value = val;
        }
            });




    this.defaultHeader={"max-height": "65px;","border": "solid 1px #009;", "min-height": "18px;","line-height":"1.3em", "margin": "0px;", "height":"20px!important;", "font-family":"merriweather;", "background": "#f0f8ff;", "color": " #009;", "text-align": "center;", "font-size": "17px;","font-weight":"700;", "resize":"none;","styleText":"max-height: 65px; border: solid 1px #009; min-height: 18px;  margin: 0px;  height:23px!important;  font-family: merriweather; color:  #009;  text-align: center; line-height:1.3em; font-weight:700; resize:none; background: #f0f8ff;"};
      
    this.defaultColor="#009";    
    this.defaultHeaderbackground="#F0F8FF";
    this.monthsCalendarHeaderClass="daysOfTheWeekHeader";
    this.monthsCalendarCellClass="calendarDays";
    // bindTo.value=this.initDisplays(this.dataArrays);
  }
   initDisplays(displayArrays){
    if(displayArrays){
         var dataarrs= displayArrays.map(function(val){return val[1];});
          return dataarrs;
      }
      else{return [];}

    }
   
   gridConstructor([col,row,gridname, dbName, columnHeaders,sheets, toolset, baseValuesArrays, userStyle, userClass, userHeaderStyle,userHeaderClass, asRows])
   {
    
    var grid=[], i=0, j=0, cell={},colArray=[]; 
    var cols=(col)?col:26; var rows=(row)?row:26; 
    var appliedClass=(userClass)?userClass:"fitter"; 
    //console.log(baseValuesArrays)
  var valuesArray=(baseValuesArrays&&baseValuesArrays.length>0)?baseValuesArrays:(baseValuesArrays===true)?this.csv:[];
  var sheetName=(gridname)?gridname: "newSheet"+this.counter;
  var input={};
 // console.log(valuesArray);
  if(columnHeaders){valuesArray=columnHeaders.concat(valuesArray);}
    for(i=0;i<cols;i++){
    
    var minWidth=0; var altitude=0;
      for(var j=0;j<rows;j++)
      {
       if(asRows===true||(columnHeaders&&i===0)){
      var value=(valuesArray&& valuesArray[j] && valuesArray[j][i])?valuesArray[j][i]:"--";
     // console.log(value);
   }
        else{value=(valuesArray&& valuesArray[i] && valuesArray[i][j])?valuesArray[i][j]:"--";}
      var str="00000";
      var co=(str+i).slice(-5);
      var ro=(str+j).slice(-5);
      var id=sheetName+"_"+co+"_"+ro+"_", keys=id.split("_");
      var name=(valuesArray===true&&this.csv && this.csv[0][i] && this.csv[j])?this.csv[0][i]+"__"+this.csv[j][0]:(this[sheetName]&&this[sheetName].length>0&&this.sheetName[i])?this[sheetName][i][0]+"__"+this[sheetName][0][j]:"add names";
      var style=(asRows===true&&keys[2]==0&&userHeaderStyle!=null)?userHeaderStyle:(asRows===true&&keys[2]==0&&userHeaderStyle==null)?this.defaultHeader.styleText:(asRows!==true&&keys[1]===0&&userHeaderStyles!=null)?userHeaderStyles:this.defaultFormat.styleText; 
      var nowTime=new Date().getTime();
      var readableTime=new Date(nowTime).toUTCString();
      var time={"time":nowTime, "readableTime":readableTime, "user": "user","change":"change"}
          var cell={"key":id, "value":value, "dbName": dbName, "contenteditable": true, "id": id, "style":  style, "name": name,"class": appliedClass, "time": time, "archive":[], "closed": false};
              var width=this.textMeasurements(cell);
              width=parseInt(width);
              minWidth=(minWidth>=width)?minWidth:width;
              
              colArray.push(cell); 
          }
        
          colArray.forEach(function(cell, ind){
            var numb=Math.ceil(parseInt(minWidth)+63);//do the cleaner removal
            cell.style+="width: " +numb+"px; ";
          });

         grid.push(colArray);
         colArray=[];
        }
    this.counter++;
    this[gridname]=grid;
    return grid;
  };



  textMeasurements(cell, units){
    var c=document.createElement("CANVAS");
    var ctx=c.getContext("2d");
    var theId="#"+cell.id
    if(cell&&cell.style){
        var ft1=cell.style.match("font-size:");
        var   cssArr=cell.style.split("font-size:");
        var inde=cssArr[cssArr.length-1].indexOf(";")
        var fs=parseInt(cssArr[cssArr.length-1].substr(inde-4,4));
        fs=parseInt(fs);
        cell.style.split("font-size:")
        var ft2= cell.style.split("font-family");
        var index=ft2[ft2.length-1].indexOf(";"); var family=ft2[ft2.length-1].slice(0, index);
          
        ctx.font =fs+"px"+ " "+family;
        var txt=cell.value;
        var width=ctx.measureText(txt).width;
        return width;
      }
    else{return "6px";}
  }
   
  dataForPresetDatabases(){
        return [

        [{"dbName": "fcFinancials", "storeName":"mid2014Monthlies", "version": 1, "columns": undefined, "rows": undefined, "size":0, "time": undefined, "changeRecord": []},this.financialGrid],
         [{"dbName": "fcCalendar", "version": 1, "storeName":"monthsCalendar", "columns": 7, "rows": 6, "size":0, "time": undefined, "changeRecord": []},this.calendarGrid]
         [{"dbName": "fcCallRecords", "version": 1, "storeName":"june2015CallSheet", "columns": undefined, "rows": undefined, "size":0, "time": undefined, "changeRecord": []},    this.fcCallRecords],
         [{"dbName": "fcCourseResultsByStudent", "version": 1,"storeName":"stacyClassSheetJuneTTH900AM", "columns": undefined, "rows": undefined, "size":0, "time": undefined, "changeRecord": []},this.courseResultsByStudent]
          ];
    }
    

};



class FocusedProfile {
	constructor(argProfile){this.build(argProfile.studentFirstName, argProfile.studentLastName, argProfile.studentTelephone, argProfile.studentEmail, argProfile.parent1FirstName, argProfile.parent1LastName, argProfile.parent1Telephone, argProfile.parent1Email, argProfile.parent2FirstName, argProfile.parent2LastName, argProfile.parent2Telephone, argProfile.parent2Email, argProfile.addressLine1, argProfile.addressLine2, argProfile.fcid);}
	build(studentFirstName,studentLastName, studentTelephone, studentEmail, parent1FirstName, parent1LastName, parent1Telephone, parent1Email, parent2FirstName, parent2LastName, parent2Telephone, parent2Email, addressLine1, addressLine2, fcid)
	{
		this.studentFirstName= studentFirstName ||"";
		this.studentLastName= studentLastName ||"";
		this.studentTelephone= studentTelephone ||"";
		this.studentEmail= studentEmail || "";
		this.parent1FirstName= parent1FirstName ||"";
		this.parent1LastName= parent1LastName || "";
		this.parent1Telephone= parent1Telephone ||"";
		this.parent1Email= parent1Email ||"";
		this.parent2FirstName= parent2FirstName ||"";
		this.parent2LastName=parent2LastName || "";
		this.parent2Telephone= parent2Telephone ||"";
		this.parent2Email= parent2Email ||"";
		this.studentFullName=this.studentFirstName + " " + this.studentLastName;
		this.addressLine1= addressLine1 ||"";
		this.addressLine2= addressLine2 ||"";
		this.fcid= fcid || this.studentLastName + this.studentFirstName + "00001";
	}

	getFanout(){
		var fanoutObj = {


		};
		fanoutObj[this.fcid]=this;
		fanoutObj.currentStudents=this;
		return fanoutObj;
	}
}
function objectArrayForPossiblePropertyValues(propertyName, arrayOfPossibleValues, context){
		var prop=propertyName;
		var arrayToInputDropdownsAndMenus=arrayOfPossibleValues.map(function(value){ 
			var retVal={"name":prop, "value": value};
			return retVal;
		}, context);
		return arrayToInputDropdownsAndMenus;

}
class FocusedAdditionalAcademics {
	constructor(argAces, fcid){this.build(argAces.completedMathCourses, argAces.completedEnglishCourses, argAces.completedScienceCourses,argAces.completedHistoryCourses, fcid);}
	build(completedMathCourses, completedEnglishCourses, completedScienceCourses,completedHistoryCourses, fcid)
	{
		var english= ["Standard English","Honors English",   "AP Language and Composition",   "AP Literature and Composition",   "English Writing Colloquim",   "I want to be a writer",   "I am currently writing for publication",   "I Have Published Work Professionally",   "Other (write what you want, it's a writing question)"],
   
         science=[ "Biology",   "Chemistry",   "Physics",   "AP Biology",   "AP Chemistry",   "AP Physics",   "AP Bio & AP Chem",   "AP Bio & AP Phys",   "AP Phys & AP Chem",   "AP Phys, AP Bio & AP Chem",   "I currently have a project with a university laboratory",   "I am currentyly doing research in industry",   "I am currently doing research for the government",   "I have a laboratory in my basement and a good friend named Igor, but I hate it when everyone calls me Dr. Frankenstein"],
        
          history=["World History",   "AP U.S. History One",   "AP U.S. History Two",   "AP Human Geography",   "AP World History",   "AP European History",   "AP Art History",   "U.S. History",   "AP Gov. & Pol.",   "I am currently involved in local politics",    "I am currently running for local or state office",    "I figured I could be President if Donald Trump could..."];
        

	this.completedMathCourses = completedMathCourses ||["Algebra I","Geometery, no Algebra I","Algebra I and Geometery","Algebra II, no Geometry","Algebra II and Geometry","Currently in Pre-Calculus","Completed Pre-Calculus","Completed Basic Statistics","Calculus AB or Higher","Completed Higher Math Courses (You May Type in Your Courses Here)","Let's Not Talk About 'THAT MATH'"];
     this.completedEnglishCourses = completedEnglishCourses || english;
     this.completedScienceCourses= completedScienceCourses || science;
	this.completedHistoryCourses = completedHistoryCourses || history;
	
	}
}
var testdateHolder=[];
  var d=new Date();
var holder=[];

class FocusedPastAcademics{
constructor (gradeLevel, currentSchool, previousEducation, educationalAspirations, startMath, startReading, startTotal,goalScore,fcid){
    var arr=localStorage.getItem('NJHS');
    arr=arr.split(",");
    //console.log(arr);
  var shadowProfile={};

  this.gradeLevel=gradeLevel||[];
  this.currentSchool=arr ||this.setCurrentSchool();
  this.previousEducation= previousEducation || [];
  this.educationalAspirations= educationalAspirations || [];
  this.startMathScore =  startMath  || [];
  this.startReadingScore = startReading || [];
  this.startTotalScore = startTotal || [];
  this.goalTotalScore=goalScore || [];
 

    this.getIncrementingAcademicProperties();
  //takes array of array values for [propertyName, startValue, endValue,  valuePhrase1, valuePhrase2, increment, isOnlyChoices]
  this.pastTestDates=[];
  testdateHolder=this.nextReasonableTestDates(8);
  //console.log(testdateHolder);
    this.getNamedEducationProperties();
  this.approachingTestDates=testdateHolder;
  //console.log(this.approachingTestDates, this.approachingTestDates[0]);
  this.daysToNextTestDate=Date.prototype.countdownDays(d,new Date(this.approachingTestDates[0]));
  //console.log(this.daysToNextTestDate);
   // this.objectArrayGeneratorForStaticGettersUsingIncrementalValuesForOnlyVariablesInChoiceArray();
    // this.getIncrementingAcademicProperties()
  if(this.gradeLevel){ this.serviceMatchLevelOne=this.computeServiceMatchLevelOne(this.gradeLevel);}

  }
                computeServiceMatchLevelOne(gradeLevel){

                    var returnVal =(gradeLevel=="Grade: 4")?["Young Scholars Reading","Young Scholars Math"]:(gradeLevel=="Grade: 5")?["Young Scholars Reading","Young Scholars Math", "Young Scholars:Young Authors"]:(gradeLevel=="Grade: 6")?["Young Scholars Reading","Young Scholars Math","Young Scholars:Young Authors","PSAT 8/9"]:(gradeLevel=="Grade: 7")?["PSAT 8/9","Young Scholars Reading","Young Scholars Math","Young Scholars:Young Authors","Focused1600Prep"]:(gradeLevel=="Grade: 8")?["1600 SAT","PSAT-NMSQT","PSAT 10","PSAT 8/9","Young Scholars II: True Scholarship"]:(gradeLevel=="Grade: 9")?["1600 SAT","PSAT-NMSQT","PSAT 10","PSAT 8/9","Young Scholars II:Deep Learning"]:(gradeLevel=="Grade: 10")?["1600 SAT","PSAT-NMSQT","PSAT 10"]:["1600 SAT"];
                    return returnVal;

                }
                nextReasonableTestDates(num){

                var allTestDates=[[2016,1,23], [2016, 3, 5],[2016, 5, 7],[2016, 6, 4],[2016, 8, 6],[2016,10,1],[2016,11,5],[2016,12,3],[2017,1,28],[2017,3,11],[2017, 5, 6], [2017, 6, 3],[2017, 8, 26],[2017, 10, 7],[2017,11,4],[2017, 12, 2],[2018,3, 10],[2018, 5, 5], [2018, 6, 2], [2018, 8, 25], [2018, 10, 6],[2018,11,3],[2018,12,1],[2019,3, 9],[2019,5,4],[2019, 6, 1]];

                	var now = new Date();
                	var i=0;
                	var testDates=allTestDates.filter(function(val){ 
                			var date=new Date(val);
                			if(date>now.addDays(+30)&&i<num){i++;return true;}
                            //returns true to win, dont know what it is though
                			else if(date<now.addDays(+30)&&date.getMonth()!==7){
                				date=new Date(date).toDateString();
                				this.pastTestDates.push(date);
                			}
                		}, this);
                	//console.log(this.lastTestDate);
                		//console.log(testDates);
                		var readableDates=testDates.map(function(date){var td=new Date(date).toDateString(); return td;});
                		//console.log(readableDates);
                		return readableDates;	
                }
                objectArrayGeneratorForStaticGettersUsingChoicesArray(propertyName, choicesArray){
                       var returnArray = choicesArray.map(function(value, index, arrauy){
                            var obj={"name": propertyName, "value": value};
                            return obj;
                        });
                        return returnArray;

                }
                objectArrayGeneratorForStaticGettersUsingIncrementalValuesForOnlyVariablesInChoiceArray([propertyName, startValue, endValue,  valuePhrase1, valuePhrase2, increment, isOnlyChoices]){
                    var returnArray=[];
                    var returnOnlyChoices=[];
                    var vp1=(valuePhrase1&&valuePhrase1!=undefined)?valuePhrase1:" ";
                    var vp2=(valuePhrase2&&valuePhrase2!=undefined)?valuePhrase2:" ";
                    var trueEnd=endValue+increment;
                    var increase=(increment&&increment!==0)?increment:1;
                    for(var i=startValue; i<trueEnd;i+=increase)
                    {
                        var value=vp1 + i + vp2;
                        var name=propertyName;
                        var obj={"name": name, "value": value};
                        returnArray.push(obj);
                        returnOnlyChoices.push(value);
                        obj={};
                    }
                    var retVal=(isOnlyChoices===true)?returnOnlyChoices: returnArray;
                    //console.log(returnArray);
                    this[propertyName]=retVal;
                }

                 setCurrentSchool(){
                      var ref=new Firebase("https://focusedstaging1.firebaseio.com/forms/callIntake/njhighschools000020160208");
                      var jason={};var njhs=localStorage.getItem('NJHS'); if(njhs){njhs=njhs.split(",");if(njhs.length>200){this.currentSchool=njhs; console.log(this.currentSchool);}}
                     else{ var ref=new Firebase("https://focusedstaging1.firebaseio.com/forms/callIntake/njhighschools000020160208");
                        ref.once('value',(snap)=>{localStorage.setItem('NJHS', snap.val()); this.currentSchool=snap.val();}, this);}
                    }
                getNamedEducationProperties(array)
                    { //[[arg.name, arg.array], [arg.name, arg.array]...essentially a maps [key, value]...];
                        var choicesArray=[["educationalAspirations",[ "Regional or State College","Private University","Competitve Private University", "Elite Private University","Masters Degree","Professional Degree", "Doctoral Degree, or Equivalent", "Other"]], ["previousEducation",["See Current School", "Home Schooled", "Boarding School", "Private Local Academy", "Public School"]]];
                      choicesArray.forEach((val)=>{
                      this[val[0]]=  val[1].reverse();
                      //console.log('julius at the party');
                    });
                    }
                   
                 getIncrementingAcademicProperties(){
                    var arrays=[["startTotalScore", 700, 1600, "Total: ", " ",10, true],["startReadingScore", 340, 800, "Reading: ", " ",10, true],["startMathScore", 340, 750, "Math: ", " ",10, true],["gradeLevel", 1, 12, "Grade: ", " ",1, true],["goalTotalScore", 1100, 1600, "Your Goal: ", " ",10, true],["gradeLevel", 1, 12, "Grade: ", " ",1, true], ["gradeLevel", 1, 12, "Grade: ", " ",1, true]];
                    
                    arrays.forEach((val)=>{var isOnlyChoices=true; var setValue =this.objectArrayGeneratorForStaticGettersUsingIncrementalValuesForOnlyVariablesInChoiceArray(val); 
                        //console.log(setValue);
                    });
                    }
                }
class FocusedInquiry{
    constructor(arrayValues, arrayKeys,messageObject, init)
    {   
        var profilesObject={};
        var profile={};
        var messageObject={};
        
            if(init!==true&&Array.isArray(arrayValues)&&Array.isArray(arrayKeys)){
                     var profile=arrayValues.reduce(function(pre, val, i, array){
                                                            return pre[arrayKeys[i]]=val;
                                                        },profilesObject);
                     //console.log(profile, profile.callerType, profile.callerRole);
                 }
            else{
                var profile={};var messageObject={};
                }
                    var d=new Date().getTime();
                    var j=d.toLocaleString();
                    var dt=j.split(" ");
                    this.messageNumber="";
                    this.isPreviousCaller= messageObject.isPreviousCaller || "",
                    this.isCurrentClient= messageObject.isCurrentClient || "",
                    this.callerType= messageObject.callerType || "",
                    this.callerRole= messageObject.callerRole || "",
                    this.callerFirstName= messageObject.callerFirstName||profile.callerFirstName || "",
                    this.callerLastName= messageObject.callerLastName||profile.callerLastName || "",
                    this.callerTelephone= messageObject.callerTelephone || profile.callerTelephone || "",
                    this.callerFullName= messageObject.callerFullName||profile.callerFullName ||"",
                    this.callerEmail= messageObject.callerEmail || profile.callerEmail ||"", 
                    this.relatedStudent= messageObject|| profile.relatedStudent || "",
                    this.fcid= messageObject.fcid || profile.fcid ||"",
                    this.date= messageObject.date|| dt[0] ||"",
                    this.time= messageObject.time|| dt[1] ||"",
                    this.timestamp= messageObject.timestamp ||"",
                    this.message= messageObject.message || messageObject.message|| "",
                    this.request= messageObject.request || "",
                    this.intakeFcid= window.user.fcid || user.fcid || "",
                    this.isClosed= messageObject.isClosed || ""




                    // this.ref=null;
                    // this.timestamp=profile.orderingTime ||d;
                    // this.readableTime=profile.date+"_"+profile.time || dt[0].replace(/\s/g, "")+"_"+dt[1].replace(/\s/g, "");
                    // this.callerFullName=profile[profile.callerRole+"FirstName"] + " " + profile[profile.callerRole+"LastName"] ||"--";
                    // this.isClosed=(messageObject.isClosed)?messageObject.isClosed:(profile.callerType&&profile.callerType=="nonClient"||profile.callerRole=="clientCompetitor")?true: false || "";
                    // this.relatedStudent=[{"fullName":profile.studentFullName, "fcid": profile.fcid}] ;
                    // //TODO BEEF UP THE CALLER MATCHING SERVICES);
                    // this.callerMessage=(messageObject&&messageObject.callerMessage)?messageObject.callerInterest: "No Message" || "";
                    // this.callerInterest=(messageObject&&messageObject.callerInterest)?messageObject.callerInterest:(profile.callerType=="newClient"||profile.callerType=="repeatCaller")?"Focused1600Course":(profile.callerType==="activeClient" || profile.callerType==="inactiveClient")?"FocusedStudyGroup":"Focused1600Course" || "";//this will have to be beefed up
                    // this.focusedProgramMatch=this.callerInterest || ""; //see TODO ABOVE
                    // this.callerExpectedFollowUp=(messageObject&&messageObject.callerExpectedFollowUp)?messageObject.callerExpectedFollowUp:this.timestamp || "" || ""; 
                    // //TODO fix the end of the line above, it will break now;
                    // this.intakeFcid=(messageObject&&messageObject.intakeId)?messageObject.intakeId:self.user || "";
                    // this.fcid=profile.fcid || "";
                    // this.callerRole=profile.callerRole || "";
                    // this.callerType=profile.callerType || "";
                    // var inqNumber=this.getFcidPastInquiryNumber(profile.fcid) || "";
                    // this.inquiryNumber =(inqNumber!=NaN)?inqNumber+1:1 || "";
                    // this.saveInquiry();
                    // this.displayInquiries();
        }
        getFcidPastInquiryNumber(){}
    } 
 
 var user={"fullName": "Jason Frazzano", "fcid": "FrazzanoJason000001", "type":"admin"};


var dataManager =new DataManager(user);







    // var entry= dataManager.dashboardMap.get(2);
    //  dataManager.getIdbDatabaseDataAndLoadToGrid(this.inquiriesSerialized,entry , 2);

window.FCBehaviors = window.FCBehaviors || {};
FCBehaviors.FocusedDataManagerBehaviorImpl= {
    listeners:{"on-message":"getcallcenterallmessages", 
                "on-scroll": "getcallcenterallmessages"},
    properties: {
        focusedManager:{
            type:Object,
            value: dataManager,
         //   observer: "observeFocusedManager",
            notify: true,
        },


      isFirstLoad:{
        type: Boolean, 
        notify: true,
        value: function(){return true},

      },

        toStorage:{
            type: Array, 
            value: function(){return [];},
            //observer: "observeToStorage",
            notify: true
        },
        chosen:{
            type: String,
            notify: true,

        },
        gridChosen:{
            type: String, 
            notify: true,
        },
    counter: {
            type: Number, 
            value: 0,
            notify: true, 
         //   observer: "observeCounter",
        },
    
    interfaceObject:{
        type: Object, 
        computed:"_computeInterfaceObject(selectedStoreNumber,interfaceType)", 
        notify: true, 

        }, 
    interfaceMap:{
        type: Map,
        value: dataManager.dashboardMap,
        notify: true, 
    },
    selectedStoreName:{
        type: String,
        value:"profilesStudentProfiles",
        notify: true,

    },
        
    selectedStoreNumber:{
            type: Number,
            notify: true,
            value: 0,
        },
    interfaceType:{
        type: String,
        notify: true,  
    }, 
    inputsDisplayArray:{
        type: Array, 
        value: function(){return [];},
        notify: true,
    },
    searchableFields:{
        type: Array, 
        notify: true,
    },
  
    inputsView:{
        type: Array, 
        value: function(){return [];},
        notify: true,
    },
    inputsViewNumber:{
        type: Number, 
        value:function(){
            return 0;
        },
        notify: true
    },
    gridDisplayArray:{
        type:Array, 
        value: function(){return [];},
        notify: true,

    },
    maxIoNumber:{
        type: Number, 
        computed: "computeMaxIoNumber(focusedManager)",
     notify: true
    },
},


computeMaxIoNumber(man){
         var  max=Math.floor(man.dashboardMap.size/2)-1;
         return max;
},



getcallcenterallmessages(e){
 var entry= this.focusedManager.dashboardMap.get(2);
   this.focusedManager.getIdbDatabaseDataAndLoadToGrid(this.focusedManager.inquiriesSerialized,entry , 2);
    
},
_computeInterfaceObject(key,interfaceType){
    this.set("interfaceMap", this.focusedManager.dashboardMap);
    //console.log(key, interfaceType);
    var  objectKeyForDisplayArray=interfaceType+"Array";
    var interfaceObject=this.interfaceMap.get(key);
    var displayArray=interfaceObject[objectKeyForDisplayArray];
    this.set("chosen", interfaceObject.value)
    var ida=interfaceType+"DisplayArray";
    this.set(ida, displayArray);
    //console.log(this[ida]);
    //console.log(this.interfaceMap, this.focusedManager.dashboardMap);
    var sf=this._computeSearchableFields(interfaceObject);
    this.set("searchableFields",sf); 
        this.set("interfaceMap", this.focusedManager.dashboardMap);
  return interfaceObject;
},

changeAppInterfaceForInputs(e){
  //console.log(this.maxIoNumber);
  var max =this.maxIoNumber;
    if(this.selectedStoreNumber==max){this.set("selectedStoreNumber",0);}
    else{this.set("selectedStoreNumber",this.selectedStoreNumber+1)}
    //console.log(this.selectedStoreNumber);
},
plusArrowForGrids(e){
    var  max=this.maxIoNumber;
    if(this.selectedStoreNumber===max){this.set("selectedStoreNumber",0);}
    else{ var plusOne=this.selectedStoreNumber+1;
        this.set("selectedStoreNumber",plusOne)}
    //console.log(this.selectedStoreNumber);
},
minusArrowForGrids(e){
    var  max=this.maxIoNumber;
    var  min=0;
    if(this.selectedStoreNumber===min){this.set("selectedStoreNumber",max);}
    else{ var minusOne=this.selectedStoreNumber-1;
        this.set("selectedStoreNumber",minusOne)}
    //console.log(this.selectedStore);

},
   
 
    observeMessageContent(nv, ov){if(nv){
        //console.log(nv, "This is the observed returned data from the search worker");
    }},
    

    observeToStorage(newValue, oldValue){if(newValue!=undefined){console.log(newValue, oldValue); }},
    
  _computeSearchableFields(interfaceObject){
       var searchableFields=[];
    interfaceObject.gridArray.forEach((column)=>{
        searchableFields.push(column[0].value);
    });
    //co.log(searchableFields);
    return searchableFields;
  }, 
    _forward(e){
        if(this.inputsViewNumber===this.inputsDisplayArray.length-1)
            {
                this.set("inputsViewNumber", 0);
                this.set("inputsView", this.displayArray[this.inputsViewNumber]);
            }
        else{
            var next=this.inputsViewNumber+1;
            this.set("inputsViewNumber", next);
            this.set("inputsView", this.inputsDisplayArray[this.inputsViewNumber]);
            
        }
    },
 _back(e){   
        if(this.inputsViewNumber===0)
        { 
            var max=this.inputsDisplayArray.length-1;
            //console.log(max);
            this.set("inputsViewNumber",max);
            this.set("inputsView",this.inputsDisplayArray[this.inputsViewNumber] );
        }
        else
        {   
            var back=this.inputsDisplayedPage-1;
            this.set("inputsViewNumber", back);
            this.set("inputsView",this.inputsDisplayArray[this.inputsViewNumber] );
        }
    },

   
gridMakerFunction(chosen, formResults, val, selectedStoreNumber){
    var databaseStuff=this.focusedManager.dashboardMap.get(selectedStoreNumber);
       
     
        
            //console.log(trueForm);
     this.submittedInputs={};
            var d = new Date();
            var n = -d.getTime();
            var readableTime=new Date().toLocaleString();
            this.submittedInputs={};
    var mappedVals= this.mapValuesToPropertiesFromInputArrays();
            this.submittedInputs=Object.assign(this.submittedInputs, val);
            var dateTime=readableTime.split(",");
            var obj={"date":dateTime[0], "time":dateTime[1]};

           
                  this.submittedInputs.studentFullName=this.submittedInputs.studentFirstName + " " + this.submittedInputs.studentLastName;
                  this.submittedInputs.fcid=this.submittedInputs.studentLastName+this.submittedInputs.studentFirstName+"_00001";
                 obj.databaseName=this.interfaceObject.dbName;
                 var dbName=this.interfaceObject.dbName;
                    obj.storeName=this.interfaceObject.storeName;
                    obj.key=this.submittedInputs.fcid;

                    obj.indicies=["studentFirstName", "studentLastName", "fcid", "parent1FirstName","parent1LastName", "parent2FirstName", "parent2LastName", "course", "coach"];
                    //co.log(this.interfaceObject, "look here this is the object you will use back and forth to database");
                    databaseStuff.indicies=obj.indicies;
                    obj.toProfile=[obj.key];
                    var refObject=obj;
                    //co.log(obj, refObject);
                    this.push("toStorage", refObject);
                
                 this.focusedManager.objectUpdatesToIdb(databaseStuff,  this.submittedInputs);
              //       if(this.arrayIndex===this.tagIndex){this.set("sameThing", true);
              //        this.set("formSubmitOne", true);}
              // else if(this.apiChoices[this.selectedApiIndex].dbName=="courseCalendars"){var refObject={};}
              // else if(this.apiChoices[this.selectedApiIndex].dbName=="events"){var refObject={};}
              // else if(this.apiChoices[this.selectedApiIndex].dbName=="inquiries"){var refObject={};}
            
            refObject=Object.assign(refObject, formResults, this.submittedInputs, {"orderingTime":n});
              //co.log(refObject);
              var storeName=this.interfaceObject.storeName;
              //var headerRow=this.createHeadersFromProperties(refObject);
              var valueRow=this.createValueRowsFromProperties(refObject);
                  this.addEntryToApiSheet(valueRow, storeName, this.sameThing, refObject, dbName);
                  dataManager.arrayWorker.postMessage({})
               
        },


mapValuesToPropertiesFromInputArrays(){
  var mappedValues=this.inputsDisplayArray.reduce(function(previous, value, index, array){
              var temp=value.reduce(function(pre, val, index, array){
                    //co.log(val);
                    var propertyA=val.nameA;
                    var valueA=val.valueA;
                    var propertyB=val.nameB;
                    var valueB=val.valueB;
                    var object={[propertyA]: valueA, [propertyB]: valueB};
                    pre=Object.assign(pre,object);
                   return pre;
                  },{});
                 previous=Object.assign(previous, temp);
                return previous;
              },{});
  return mappedValues;

},
createReferenceObject(propertiesExample){
     var d = new Date();
            var n = -d.getTime();
            var readableTime=new Date().toLocaleString();
    var dateTime=readableTime.split(",");
    var obj={"date":dateTime[0], "time":dateTime[1]};
                    obj.dbName="Profiles";
                    obj.storeName="basicProfiles";
                    obj.key="fcid";
                    obj.indicies=(obj.dbName=="Profiles")?["studentFirstName", "studentLastName", "fcid", "parent1FirstName","parent1LastName", "parent2FirstName", "parent2LastName", "course", "coach"]:["fcid", "callerFullName", "studentFullName", "parent1FirstName", "parent1LastName"];
                    obj.toProfile=[obj.key];
                    var refObject={};
                    if(obj.dbName=="Profiles"){
                        var betterOrder=new FocusedProfile({});
                    refObject=Object.assign(refObject,{"date":dateTime[0], "time":dateTime[1]}, {studentFullName: "--", "fcid":"--", "active": "--"},betterOrder, propertiesExample, {"orderingTime":n});
                    }
                   keys=Object.keys(refObject);
                    keys.forEach((key)=>{
                        refObject[key]="--";
                    });
                    //co.log(refObject);
 return {"headers":refObject,"profilesMeta": obj};

},
mapValuesFromIndexedDb(dbName, idbReturns, dsv, storeName, version){
    //co.log(dbName, idbReturns, dsv, storeName, version);
      var dbName =dbName;
      var data=idbReturns;
      var dsv=dsv;
      var refObj=this.createReferenceObject(idbReturns);
      
       var valueRows =this.createValueRowsFromIdb(refObj.headers, idbReturns, idbReturns.profilesMeta);
       var headers =this.createHeadersFromProperties(refObj.headers);
      var counter=idbReturns.length;
      var i=1;
      var sheet=1;
      Polymer.Base.set("tagIndex", dsv.value.length);
      this.tagIndex=dsv.value.length;
      this.createGridForAnApi(headers, valueRows,this.tagIndex, refObj, dsv);
     

},

createHeadersFromProperties(refObject){
  var keys=Object.keys(refObject);
                  var headers =keys.map(function(val,i,arr){
                            var label=val.replace(/([A-Z])/g, ' $1'),  
                            label=label.replace(/^./, function(label){ return label.toUpperCase(); }),
                            label=label.replace("1", " One"),
                            label=label.replace("2", " Two");
                          return label;
                      });
                return [headers];
},

createValueRowsFromProperties(refObject){
      var keys=Object.keys(refObject);
          var baseValuesArrays=[];
                baseValuesArrays=keys.map(function(key, ind, array){
                            var cellContents=(refObject[key])?refObject[key]:"--";
                            //co.log(cellContents);
                           return cellContents;
                          });
                return [baseValuesArrays];
              },
createValueRowsFromIdb(refObject, valObjectArray){
    returnArray=[];

         var keys=Object.keys(refObject);

returnArray= valObjectArray.map((valObject)=>{
          var baseValuesArrays=[];
                baseValuesArrays=keys.map(function(key, ind, array){
                            var cellContents=(valObject[key])?valObject[key]:"--";
                            //co.log(cellContents);
                           return cellContents;
                          });
                return baseValuesArrays;
              });
    var helper= "focusedManager."+ refObject.dbName +"_"+ refObj.storeName;
    this.set(helper, returnArray);
    return returnArray;
},

  //this is for an initialization of a gric

  createGridForAnApi(headers, rows,trueApiGridIndex, referenceObject, dsv){      
                var cols=40;
                var row=rows.length;  
                //co.log(row, cols);  
                var gridname=(this.selectedApi)?this.selectedApi.storeName:referenceObject.storeName;
                var dbName=(this.selectedApi)?this.selectedApi.dbName:(referenceObject.dbName)?referenceObject.dbName:"Profiles";
                var sheets=1, toolset="null";
                //co.log(row);
                //TODO: COME UP WITH AND BUILD TOOL SETS FOR API GRIDS ETC.
                //EXAMPLE: MATH FOR THE FINANCIALS
                //EXAMPLE: CONNECTION TO PAYMENT FOR FINANCIALS
                var userStyle=undefined,userClass=undefined, userHeaderStyle=undefined, userHeaderClass=undefined;
                var isDataInRows=true;
              this.pickle={};
              this.pickle=new DataGrids();
              var array= this.pickle.gridConstructor([cols,row,gridname, dbName, headers,sheets, toolset, rows, userStyle, userClass, userHeaderStyle,userHeaderClass, isDataInRows]);
              var str="00000";
              var co=(str+trueApiGridIndex).slice(-5);
              var ngrid=(referenceObject)? referenceObject.dbName+"00"+referenceObject.storeName:this.selectedApi.dbName+"|"+this.selectedApi.subStore+"|"+co; 
          this[ngrid]=array;
          //co.log(array, this.dataArrays, this.dataDisplays);
         
         //co.log(dsv.value, array); dsv.value.push(array);
          Polymer.Base.set("profileApi", array);
          Polymer.Base.set("selectedApi", array);
         
},

addEntryToApiSheet(vals, sheetNumber, samePage, refObj){
    console.log(vals);
    if(this.sameThing===true){this.set("arrayIndex", this.tagIndex);}
    //co.log(this.arrayIndex, this.tagIndex);
    if(this.tagIndex===this.arrayIndex){console.log("WE ARE THE SAME YEAH YEAH YEAH");}
    
    for(var i=0;i<this.gridDisplayArray.length;i++)
    {
          var str="00000";
              var co=(str+i).slice(-5);
              var ro=(str+newRowNumber).slice(-5);
          var id=this.selectedApi.gridId+"_"+co+"_"+ro+"_";
          var appliedClass="layout horizontal flex around-justified";
          var val=vals[0][i];
          val=(val==undefined)?"--":val;
          var previousRow=newRowNumber-1;
          var sty=this.dataArrays[this.tagIndex][i][1].style;
        
          var archive=[];
          var name=this.dataArrays[this.tagIndex][i][0].value;
          name=name.replace(/\s/g,"");
          name=name.charAt(0).toLowerCase()+name.slice(1);
          //co.log(name, val, val, val);
          archive.push(val);
          var time=new Date().getTime();
        
            var cell={"key":id, "value":val, "contenteditable": true, "id": id, "style":  sty, "dbName":this.selectedApi.dbName, "storeName": this.selectedApi.storeName, "name": name, "class": appliedClass, "time": time, "archive":archive, "closed": false};
            var width=this.textMeasurements(cell);
            width=parseInt(width)+63;
          var cellStyleArrayForWidth=this.dataArrays[this.tagIndex][i][previousRow].style.split("width:");
          ////co.log(cellStyleArrayForWidth);
          var lastone=cellStyleArrayForWidth.length-1;
          var cellWidthForParseInt=cellStyleArrayForWidth[lastone].split(";");
          ////co.log(cellWidthForParseInt);
          if(this.tagIndex===this.arrayIndex){var assign=this.tagIndex;}
          var colWidth=parseInt(cellWidthForParseInt[0]);//console.log(colWidth);
            if(width>colWidth){console.log("TOOSMALL");}
            if(this.tagIndex===this.arrayIndex){console.log("WE ARE THE SAME YEAH YEAH YEAH");this.splice(["selectedArraySet",this.tagIndex,i],newRowNumber,0,cell);}
          this.splice(["dataArrays",this.tagIndex,i],newRowNumber,0,cell);
          inq=[vals, refObj];
          //dataManager.arrayWorker.postMessage=({data: {"valArray": vals, "propertyNames": refObj}, request: "constructAndRecordInquiry"});
        
          //console.log(this.arrayIndex, this.tagIndex);
    }
    dataManager.arrayWorker.postMessage({"data":vals, "propertyNames": refObj, requestType:"constructAndRecordInquiry"});
  },

  regularizeColumnWidth(grid, columnsToChange){
    if(columnsToChange==="all" || columnsToChange===undefined){
      grid.forEach(function(column,index, array){
        this.setColumnWidthToText(column);
          
          },this); 
        }     
            
    },
        
  setColumnWidthToText(column){
        var minWidth;
        for(var i=0; i<column.length; i++){
        var cell=column[i];
          var width=this.textMeasurements(cell);
          width=parseInt(width);
          minWidth=(minWidth>=width)?minWidth:width;

          celolumn.forEach(function(cell, ind){
            var numb=Math.ceil(parseInt(minWidth)+63);//do the cleaner removal
            cell.style+="width: " +numb+"px; ";
            this[mapName].set(cell.key, [cell.value, cell]);
          }, this);
    }

  },
  addCallerTypeToGrids(args){                    
            var grid = args.grid,valueObject=args.valueObject, context=args.context,keyz=Object.keys(this.valueObject), data=[];

            console.log(valueObject);

            var gskey=args.gridStoreKeys.dbName+"-"+args.storeName;
                      console.log(grid, valueObject, context);     
            var superArgs=this.getGridInsertionCoordinates(grid, valueObject, context);
                row= superArgs.rowIndex;
                var time=new Date().getTime();
                var counter=grid.length
            for(var i=0;i<counter;i++){    
              var newCell={},nextCell={};
              nextCell=valueObject.undefined; 
              console.log(nextCell);
              var str="00000";
              var co=(str+i).slice(-5),ro=(str+row).slice(-5), gridKey=gskey+"_"+co+"_"+ro+"_";
              var propertyName=context.focusedManager.labelToPropertyName(grid[i][0].value);
              var fullnameprop=valueObject.role+"FullName";
              var fullName=valueObject[fullnameprop];
                        
              newCell={"key":gridKey, "id": gridKey, "value":valueObject[propertyName], "contenteditable": true, "style":  nextCell.style,"class": "",name: propertyName, propertyName: propertyName, "time": time, "archive":[], "closed": false, fullName: fullName, fcid: valueObject.fcid,};
                
                context.splice(["gridDisplayArray",i],row, 0,newCell);
                data.push(newCell);
                }
            context.set("focusedManager.arrayWorker.valueObject", context.valueObject);
            context.set("focusedManager.arrayWorker.gridDisplayArray", context.gridDisplay);
            //context.focusedManager.arrayWorker.postMessage({"requestType": "addStudentToProfilesGrid", valueObject: valueObject}); //this should be db worker
            this.reorderKeys(grid);
          },

        getGridInsertionCoordinates(grid, valueObject, context){
                var property=valueObject.role+"LastName",
                label=context.focusedManager.propertyNameToLabel(property);
                var i=0,columnIndex=-1, rowIndex=-1,
                newCaller=(valueObject.type==="newCaller")?true: false;
            while(i<length){
                var header= grid[i][0].value;
                if(label===header){
                      columnIndex=i;  
                      var newArray= grid[i];
                      var obj={};
                      obj.value=valueObject[property];
                    if(newCaller===true){
                            newArray.unshift(obj);
                      }
                    var valsArray=newArray.map((ob,index)=>{return ob.value}).sort((a,b)=>{var indexer=(a > b) ? 1 : ((b > a) ? -1 : 0);});
                      rowIndex=valsArray.indexOf(valueObject[property]);
                          break;
                      }
                else{i++;}
                }
              return {"rowIndex":rowIndex, "columnIndex": columnIndex, "valueObject":valueObject, "grid": grid};
            }, 

    reorderKeys(array){
        var columns=array.length;
        var rows=array[0].length;
        var key=array[0][0].id;
        var keys=key.split("_");
        var name=keys[0];
        for(var i=0;i<columns;i++){
          columnArray=[];
          for(var j=0; j<rows;j++){
            var str="00000";
            var col=(str+i).slice(-5);
            var row=(str+j).slice(-5);
            var nkey=name+"_"+col+"_"+row+"_";
            this.set(["gridDisplayArray", i, j, "id"],nkey);
            this.set(["gridDisplayArray", i, j, "key"],nkey);
          }
        }
       var version=undefined; 
       //this.indexedDataBases[this.arrayIndex].version;
      // console.log(this.selectedArraySet, this.indexedDataBases);
        var newVersion=version+1;
        var columns=this.gridDisplayArray.length;
        var rows=this.gridDisplayArray[0].length;
        var product=rows*columns;
        console.log("here is where you should be saving grid");
        //this.notifyVersionChangeToIndex(name, newVersion, rows, columns, product);
        //this.initializeIndexDB(name, version,this.selectedArraySet)
      }



}

FCBehaviors.FocusedDataManagerBehavior=[
        FCBehaviors.FcGridStyleBehavior, FCBehaviors.FocusedDataManagerBehaviorImpl];
</script>


<!-- 
   // getFcidPastInquiryNumber(profilefcid){};
    // saveInquiry(ref){
    //     var inq = ref.child("inquiries");
    //     var key1= -(new Date(this.timeStamp).getTime()) + "_" + this.fcid;
    //     var savObject ={};
    //     savObject[key1]=this;
    //     inq.update(savObject);
    //     var student = ref.child("students/" + this.fcid + "/inquiries");
    //     student.update(savObject);
    // }
    // displayInquiries(){}
// }
 
// var arraysVal={};
// arraysVal.value=[];
// var drays=new DataGrids(arraysVal);
// arraysVal.value=drays.initDisplays(drays.dataArrays);
// console.log(arraysVal.value);
// // setTimeout(()=>{drays.createIndex("indexOfDatabases", 1, false, drays.localDisplayedOfDBIndexSetter,drays);},1);
// // setTimeout(()=>{drays.makeGrids(drays.dataArraysCallBackSetter,drays);},2);



//
// // DataManager.prototype.arrayWorker.catch=(e)=>{
// // this.messageValue=e;
// // console.log(e);
// // this.catch(e)=DataManage.prototype.arrayWorker.onmessage.catch(e);
// // };
// var dataManager =new DataManager(user);
// var chump=new FocusedPastAcademics({}),
// chimp=new FocusedAdditionalAcademics({});
// var dataToAdd={};
 
// dataToAdd=Object.assign(dataToAdd, chump, chimp);
// dataManager.arrayWorker.postMessage({data:dataToAdd, requestType:"getAllProfiles"});
// var profileCollection={};
// dataManager=Object.assign(dataManager, drays);
// var constArray= [FocusedProfile,FocusedPastAcademics,FocusedAdditionalAcademics, FocusedInquiry];
// var addOns=dataManager.getAddOns();
// dataManager.setPropertiesFromConstructorsToInitializeInputsForAnApi(constArray, dataManager.intakeInputs, addOns); 
// dataManager.courseCalendarCreationArrays=dataManager.courseInputGetter();
// dataManager.arrayWorker.postMessage({data:"Profiles", requestType:"deleteDatabase"})
// dataManager.arrayWorker.onmessage=function(e){
//     if(e.data&& e.data[1]&&e.data[2]){
    
//         var messageList=JSON.parse(e.data[2]);
//     console.log("do we ever do this");
//     e.data[1].messageList=[];
//     e.data[1].messageList=messageList;
//     profileCollection[e.data[1].fcid]=e.data[1];
//     console.log(profileCollection, "Do We Ever Do this");
// }
//     else if(e.data&&e.data[0]&&e.data[0]=="searchKeys"){
//         console.log(e.data[1]);
//     }
//     else{console.log(e.data);}
// };

// console.log(dataManager);
//  dataManager.arrayWorker.postMessage({data:"", requestType: "getDatabase", dbName: "Profiles", storeName: "basicProfiles", version: 2} );
//  var idbReturns=[];
// dataManager.arrayWorker.onmessage=(e)=>{
//     if(e.data.returnMessage=="databaseReturn"){
//                 var req=e.data;    
    
// window.FCBehaviors.FocusedDataManagerBehaviorImpl.mapValuesFromIndexedDb(req.dbName, req.data, arraysVal, req.storeName, req.version);

//     }
// };

// dataManager.arrayWorker.onmessage=(e)=>{
//     if(e.data.returnMessage=="build"){var data=e.data.data; var name = e.data.name;
//         console.log(name, data, e.data.returnMessage);
//  var req=e.data;     

// window.FCBehaviors.FocusedDataManagerBehaviorImpl.mapValuesFromIndexedDb(name, data, arraysVal, req.storeName, req.version);
//     }
// };


//dataManager.setPropertiesFromConstructorsToInitializeInputsForAnApi(inquiryArray, dataManager.inquiryApi);
//console.log(dataManager);
//dataManager.arrayWorker.postMessage({data:"callCenter", requestType:"deleteDatabase"});

// var inq={};
// inq=new FocusedInquiry({});
// dataManager.inquiryApi=inq;

//  var idbReturns=[];
// dataManager.arrayWorker.onmessage=(e)=>{
//     if(e.data.returnMessage=="databaseReturn"){
//                 var req=e.data;    
    
// window.FCBehaviors.FocusedDataManagerBehaviorImpl.mapValuesFromIndexedDb(req.dbName, req.data, arraysVal, req.storeName, req.version);

//     }
// };

// DataManager.prototype.falseInitLocalStorageIndex=function(args){
//         var i=window.localStorage.getItem("databaseIndex");
//          if(i){
//             // this.getIndexOnLoad();
//         }
//         else{
//         var notargs=[{dbName:"Profiles", storeName:"basicProfiles", version:2}, {dbName:"callCenter", storeName:"allMessages", version:4}, {dbName:"callCenter", storeName:"MessageDetails", version:4}, {dbName:"callCenter", storeName:"profilesAndMessages", version:4}];
//         var index={}; index.database=[]; index.databaseObjects=[]; index.archive=[];
//             notargs.forEach((db)=>{
//             var key= db.dbName+"_"+db.storeName+"_"+db.version;
//                     index.database.push(key);
//                     index.databaseObjects.push(db);
//                     index[db.dbName +"Current"]=db.version;
//                     var d=new Date().getTime();
//                     index.archive.push({user:this.user, time: d, change: "INDEX", dbName: db.dbName, storeName: db.storeName, version: db.version});
//             });
//             index=JSON.stringify(index.toString);
//             console.log(index);
//                 window.localStorage.setItem("databaseIndex", index);
//         //     if(!args){
           
//                     return index;
//         //         }
//         // }
//         // }
//         // }
//     }
// }

// DataManager.prototype.updateLocalStorageIndex=function(dbName, storeName, version, whatWasDone){
//     var index=window.localStorage.getItem("databaseIndex");
//     console.log(index);
//     var d=new Date().getTime();
//     //use string matching on the keys here... cant have empties that deep
//     var ind=index[dbName][storeName][version];
//     var vs=(version>1)?parseInt(version)-1: false;
    
//     if(index[dbName]&&index[dbName][storeName]&&index[dbName][storeName][version]){
//         index.archive.push(ind);
//         }
//     ind={user:this.user, time: d, change: whatWasDone, dbName: dbName, storeName: storeName, version: version};
//     if(index[dbName][storeName]&&!index[dbName][storeName][version]&&vs){
//                 var last=index[dbName][storeName][vs];
//                 index[dbName].archive.push(last);
//                 var oldkey=dbName+"_"+storeName+"_"+vs;
//                 var i=index.databases.idexOf(oldkey);
//                 index.databases.splice(i, 1);
//                 }
//         index[dbName].current=version;
//         index.archive.push(ind);
//         var newkey=dbName+"_"+storeName+"_"+version;
//         index.database.push(newKey);
//         window.localStorage.setItem("databaseIndex", index);
//     }
// DataManager.prototype.getIndexOnLoad=function(){
//      var index=window.localStorage.getItem("databaseIndex");   
//      index.database.forEach((key)=>{
//             var keys=key.split("_");
//            obj = {"dbName": key[0], "storeName": key[1], 'version': key[2], "requestType": "getDatabase"};
//             this.arrayWorker.pushMessage(obj);
//             return obj;
//             });
// }


makeInputPage(objArr){
    var kvals=objArr.map(function(val,index,array){
    var keys=Object.keys(val);
    var numbKeys=keys.length;
    ////console.log(keys);
    return keys.reduce(function(pre,key, i,arr){
      pre.push([key,val[key]]);
      //console.log(pre, key, val[key]);
      return pre; 
      },[]);
    });
  //console.log(kvals);
  var bigArray=[];
  var numPairs=kvals.length;
  var arrayPair=[];
  var pageArray=[];
  for(var i=0;i<numPairs;i++){
    var last=kvals[i].length-1;
    for(var j=0;j<kvals[i].length;j++)
    { 
      arrayPair.push(kvals[i][j]);
      if(j>0&&j%2===0){
      var obj=this.makeInputPairObject(arrayPair);
      pageArray.push(obj);
      arrayPair=[];
      }
      if(j===last){
        bigArray.push(pageArray);
        pageArray=[];
      }
      else if (j===last&&pageArray.length!==0){
          bigArray.push(pageArray);

      }
      else if(j===last&&pageArray.length===0&&arrayPair.length!==0){
        bigArray.push(obj);
      }
      
    }
  }
  //console.log(bigArray);
  return bigArray;

  },

  makeInputPairObject(pairArray){

    var keyA=pairArray[0][0];
    var valA=pairArray[0][1];
    var keyB="addProperty";
    var valB="Add Value"
    if(pairArray[1]){
    keyB=pairArray[1][0];
    valB=pairArray[1][1];
    //console.log(valB, keyB, pairArray);
    }
    if(keyB==="name"){
      var holderK=keyA;
      var holderV=valA;
      keyA=keyB;
      keyB=holderK;
      valA=valB;
      valB=holderV;
    }

    var object={};
      object.dropdownItemsA=(Array.isArray(valA))?valA:false;
      object.dropdownItemsB=(Array.isArray(valB))?valB:false;
      //console.log(keyA);
      object.labelA=keyA.replace(/([A-Z])/g, ' $1').replace(/^./, function(str){ return str.toUpperCase(); }); 
      //console.log(object.labelA);
      object.labelB=keyB.replace(/([A-Z])/g, ' $1').replace(/^./, function(str){ return str.toUpperCase(); });
      object.nameA=keyA;      
      object.nameB=keyB;      
      object.valueA=(!Array.isArray(valA))?valA:false;    
      object.valueB=(!Array.isArray(valB))?valB:false;
    return object;    
    },




      //      createIndicies(dataArrays){
      // var indexOfDatabases=[];
      // var counter=dataArrays.length;
      // for(var j=0; j<counter;j++){ 
      //            var gridKey=dataArrays[j][0];  
      //             var dataArray=dataArrays[j][1];
      //             var columns=(gridKey.columns&&gridKey.columns>0)?gridKey.columns:dataArray.length;
      //             var rows=(gridKey.rows&&gridKey.rows>0)?gridKey.rows:dataArray[0].length;
      //             var data=dataArray.map(function(colHolder, col){
      //                 return colHolder;
      //                 }).reduce(function(pre, val){
      //                     return pre.concat(val);
      //                 },[]);
      //                 //console.log(data);
      //             //descriptor object in 00, value on 01, map model[[keys, values], [keys, values]
      //             var version=gridKey.version;
      //             var dbName=gridKey.dbName;
      //             var nowTime=new Date().getTime();
      //             var readableTime=new Date(nowTime).toUTCString();
      //             var time={"time":nowTime, "readableTime":readableTime, "user": "user","change":"change"}
      //             var storeName = gridKey.storeName; 
      //             var numObj=data.length;
      //             var indexEntry={
      //                 "dbName": dbName,
      //                 "name": dbName,
      //                 "version": version, 
      //                 "columns": columns,
      //                 "rows": rows,
      //                 "size": numObj,
      //                 "time": nowTime,
      //                 "value": dataArray,
      //                 "changeRecord": time,
      //                 "key":storeName,
      //                 "storeName": storeName,
      //                 "indicies": ["key", "dbName", "closed", "value", "time", "user"],
      //                 "dataStream": data,
      //               };

      //         indexOfDatabases.push(indexEntry);
      //         indexEntry=[];
      //         data=[];
      //         } 
      //         return indexOfDatabases;
      //       }
 // createIndex(indexName,indexVersion){ this.getObjectStore("indexOfDatabases",1, false, this.localDisplayedOfDBIndexSetter);   




        // selectedDb:{
        //     type:Array,
        //     notify: true,
        // },
        // selectedApiViewIndex:{
        //     type: Number,
        //     notify: true,
        //     value: 0,
        //     observer:"observeSelectedApiViewIndex",
        // },
        //  tagList:{
        //     type: Number,
        //     observer:"observeTagsAndTagRelationships",
        // },
        // gridMakerInputs:{
        //     type:Array, 
        //     value: function(){return [];},
        //     notify: true,
        // },
       
        messageContent:{
            type: Object, 
            // computed: "computeMessageContent(searchWorker)",
            notify: true, 
            observer: "observeMessageContent",
        },


function(){ 
//                 var drays=new DataGrids(arraysVal);
// arraysVal.value=drays.initDisplays(drays.dataArrays);
// console.log(arraysVal.value);
setTimeout(()=>{drays.createIndex("indexOfDatabases", 1, false, drays.localDisplayedOfDBIndexSetter,drays);},1);
setTimeout(()=>{drays.makeGrids(drays.dataArraysCallBackSetter,drays);},2);


var user={"fullName": "Jason Frazzano", "fcid": "FrazzanoJason000001", "type":"admin"};
DataManager.prototype.arrayWorker=new Worker("indexedDbWorker.js");
// DataManager.prototype.arrayWorker.catch=(e)=>{
// this.messageValue=e;
// console.log(e);
// this.catch(e)=DataManage.prototype.arrayWorker.onmessage.catch(e);
// };
var dataManager =new DataManager(user);
var chump=new FocusedPastAcademics({}),
chimp=new FocusedAdditionalAcademics({});
var dataToAdd={};
 
dataToAdd=Object.assign(dataToAdd, chump, chimp);
dataManager.arrayWorker.postMessage({data:dataToAdd, requestType:"getAllProfiles"});
var profileCollection={};
dataManager=Object.assign(dataManager, drays);
var constArray= [FocusedProfile,FocusedPastAcademics,FocusedAdditionalAcademics, FocusedInquiry];
var addOns=dataManager.getAddOns();
dataManager.setPropertiesFromConstructorsToInitializeInputsForAnApi(constArray, dataManager.intakeInputs, addOns); 
dataManager.courseCalendarCreationArrays=dataManager.courseInputGetter();

createColumnsAndRows(cells){          
                     var topArray=[];
                     var lastVal=cells.length-1;
                     var grid =cells.reduce((pre, val, i, arr)=>{
                       var valKeys=val.id.split("_"); 
                        if(pre.length==0)
                          {
                            pre.push(val); 
                            return pre;
                            }
                        else {  
                                var last=pre.length-1;
                                var keys=pre[last].id.split("_");
                                var valKeys=val.id.split("_");
                                }
                                if(keys[1]==valKeys[1]&&i!==(lastVal))
                                { 
                                  pre.push(val); return pre;
                                }
                                else if(keys[1]!=valKeys[1]){
                                  topArray.push(pre); 
                                  var newArr=[];
                                  newArr.push(val);
                                  return newArr;
                                }
                                else if(i==(lastVal)&&keys[1]==valKeys[1]){
                                  pre.push(val);
                                  topArray.push(pre);
                                  return topArray;
                                }
                                else if(i==(lastVal)&&keys[1]!=valKeys[1]){
                                  topArray.push(pre); 
                                  var newArr=[];
                                  newArr.push(val);
                                  topArray.push(newArr);
                                  return topArray;
                                }         
                          }, []);
                     return grid;
      }
   // getObjectStore(name,version, asGrid, callbackSetter){}
    
    createIndex(indexName,indexVersion){
      //this.getObjectStore("indexOfDatabases",1, false, this.localDisplayedOfDBIndexSetter);   
      }
    makeGrids(setter, context){
      //console.log(context.indexOfDatabases,context, "this",this, this.indexOfDatabases);
      var index=(this.indexOfDatabases&&this.indexOfDatabases.length>0)?this.indexOfDatabases:context.indexOfDatabases;
      //console.log("index", index);
        for(var i=0;i<index.length;i++){
        var name=index[i].name;
        var version=index[i].version;
       // this.getObjectStore(name, version, true,setter,context); 
        }
      }


  makeGrids(setter, context){
      console.log(context,"this", this);
      var index=(this.indexOfDatabases&&this.indexOfDatabases.length>0)?this.indexOfDatabases:context.indexOfDatabases;
      console.log("index", index);
        for(var i=0;i<index.length;i++){
        var name=index[i].name;
        var version=index[i].version;
        this.getObjectStore(name, version, true,setter,context); 
        }
      }


  apiChoices:{
            type: Array, 
            value: function(){ return[{"value": "Profiles","dbName": "Profiles",version: 2,  "storeName":"basicProfiles","tag":"studentIntakes", "inputsIndex":0, "displayIndex":1},
                    {"value": "Course Calendars", "storeName": "courseCalendars", version: 1, "dbName": "Course", "tag": "calendarsAtCourseSignUp", "inputsIndex": 1, "displayindex": 2},
                    {"value": "All Messages", "dbName": "callCenter", version: 4, "storeName": "allMessages","tag": "dailyMessageList", "inputIndex": 4, "displayedIndex": `0 through 6`},
                    {"value": "All Messages", "dbName": "callCenter", version: 4, "storeName": "allMessages","tag": "dailyMessageList", "inputIndex": 4, "displayedIndex": `0 through 6`},
                    {"value": "Student Homework Results", "dbName": "studentResults", version: 1, "storeName": "homeworkResults","tag": "byPercentCorrect", "inputIndex": 3, "displayedIndex": 3},
                    {"value": "Student Test Results", "dbName": "studentResults", version: 1, "storeName": "testResults","tag": "byImprovementTotal", "inputIndex": 5, "displayedIndex": 5},
                    {"value": "Intakes", "dbName": "callCenter", "storeName": "callIntakes", version: 1, "tag": ["shortFormProfile", "messageDetails", "eachFieldTextSearch", "smartContentSearch"], "inputIndex": 6, "displayindex": 1 ||6}];
                       },
          notify: true,
        },
localSave(){
        // this.gridWorker.postMessage({"operation":"createApiDatabases", "datum":obj});
        // //this.gridWorker.posrMessage({"operation": "createApiDatabases"})
        // this.fireWorker.postMessage({"operation": "saveToFirebaseWithFanout", "datum": obj});
  },


makeGrids(setter, context){
      console.log(context,"this", this);
      var index=(this.indexOfDatabases&&this.indexOfDatabases.length>0)?this.indexOfDatabases:context.indexOfDatabases;
      console.log("index", index);
        for(var i=0;i<index.length;i++){
        var name=index[i].name;
        var version=index[i].version;
        this.getObjectStore(name, version, true,setter,context); 
        }
      }
 //    createIndicies(dataArrays){
 //      var indexOfDatabases=[];
 //      var counter=dataArrays.length;
 //      for(var j=0; j<counter;j++){ 
 //                 var gridKey=dataArrays[j][0];  
 //                  var dataArray=dataArrays[j][1];
 //                  var columns=(gridKey.columns&&gridKey.columns>0)?gridKey.columns:dataArray.length;
 //                  var rows=(gridKey.rows&&gridKey.rows>0)?gridKey.rows:dataArray[0].length;
 //                  var data=dataArray.map(function(colHolder, col){
 //                      return colHolder;
 //                      }).reduce(function(pre, val){
 //                          return pre.concat(val);
 //                      },[]);
 //                      //console.log(data);
 //                  //descriptor object in 00, value on 01, map model[[keys, values], [keys, values]
 //                  var version=gridKey.version;
 //                  var dbName=gridKey.dbName;
 //                  var nowTime=new Date().getTime();
 //                  var readableTime=new Date(nowTime).toUTCString();
 //                  var time={"time":nowTime, "readableTime":readableTime, "user": "user","change":"change"}
 //                  var storeName = gridKey.storeName; 
 //                  var numObj=data.length;
 //                  var indexEntry={
 //                      "dbName": dbName,
 //                      "name": dbName,
 //                      "version": version, 
 //                      "columns": columns,
 //                      "rows": rows,
 //                      "size": numObj,
 //                      "time": nowTime,
 //                      "value": dataArray,
 //                      "changeRecord": time,
 //                      "key":storeName,
 //                      "storeName": storeName,
 //                      "indicies": ["key", "dbName", "closed", "value", "time", "user"],
 //                      "dataStream": data,
 //                    };

 //              indexOfDatabases.push(indexEntry);
 //              indexEntry=[];
 //              data=[];
 //              } 
 //              return indexOfDatabases;
 //            }
 // createIndex(indexName,indexVersion){
 //     // this.getObjectStore("indexOfDatabases",1, false, this.localDisplayedOfDBIndexSetter);   


 class FocusedInquiry{
    constructor(arrayValues, arrayKeys,messageObject)
    {   
        var profilesObject={};
            if(Array.isArray(arrayValues)&&Array.isArray(arrayKeys)){
                     var profile=arrayValues.reduce(function(pre, val, i, array){
                                                            return pre[arrayKeys[i]]=val;
                                                        },profilesObject);
                     console.log(profile, profile.callerType, profile.callerRole);

                    this.ref=null;
                    this.timestamp=profile.orderingTime;
                    this.readableTime=profile.date+"_"+profile.time;
                    this.callerFullName=profile[profile.callerRole+"FirstName"] + " " + profile[profile.callerRole+"LastName"];
                    this.isClosed=(messageObject.isClosed)?messageObject.isClosed:(profile[callerType]=="nonClient"||profile[callerRole]=="clientCompetitor")?true: false;
                    this.relatedStudent=[{"fullName":profile.studentFullName, "fcid": profile.fcid}];
                    //TODO BEEF UP THE CALLER MATCHING SERVICES);
                    this.callerMessage=(messageObject&&messageObject.callerMessage)?messageObject.callerInterest: "No Message";
                    this.callerInterest=(messageObject&&messageObject.callerInterest)?messageObject.callerInterest:(profile.callerType=="newClient"||profile.callerType=="repeatCaller")?"Focused1600Course":(profile.callerType==="activeClient" || profile.callerType==="inactiveClient")?"FocusedStudyGroup":"Focused1600Course";//this will have to be beefed up
                    this.focusedProgramMatch=this.callerInterest; //see TODO ABOVE
                    this.callerExpectedFollowUp=(messageObject&&messageObject.callerExpectedFollowUp)?messageObject.callerExpectedFollowUp:this.timestamp; 
                    //TODO fix the end of the line above, it will break now;
                    this.intakeFcid=(messageObject&&messageObject.intakeId)?messageObject.intakeId:self.user;
                    this.fcid=profile.fcid;
                    this.callerRole=profile.callerRole;
                    this.callerType=profile.callerType;
                    var inqNumber=this.getFcidPastInquiryNumber(profile.fcid);
                    this.inquiryNumber =(inqNumber!=NaN)?inqNumber+1:1;
                    this.saveInquiry();
                    this.displayInquiries();
                }
    } 
    getFcidPastInquiryNumber(profilefcid){}
    saveInquiry(ref){
        var inq = ref.child("inquiries");
        var key1= -(new Date(this.timeStamp).getTime()) + "_" + this.fcid;
        var savObject ={};
        savObject[key1]=this;
        inq.update(savObject);
        var student = ref.child("students/" + this.fcid + "/inquiries");
        student.update(savObject);
    }
    displayInquiries(){}
}
 //      }-->